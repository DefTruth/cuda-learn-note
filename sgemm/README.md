# SGEMM 

## 0x00 说明

包含以下内容：

- [X] sgemm_naive_f32_kernel 
- [X] sgemm_sliced_k_f32_kernel 
- [X] sgemm_t_8x8_sliced_k_f32x4_kernel
- [X] PyTorch bindings

## 测试

```bash
# 只测试Ada架构 不指定默认编译所有架构 耗时较长
export TORCH_CUDA_ARCH_LIST=Ada 
python3 sgemm.py
```

输出:

```bash
-------------------------------------------------------------------------------------
                                   M=2048, N=2048, K=1024
             out_f32: [7.53856945, 50.31977081, -7.74004459], time:2.58126259ms
         out_f32(sk): [7.53856945, 50.31977081, -7.74004459], time:1.84306383ms
   out_f32x4(t8x8sk): [7.53856945, 50.31977081, -7.74004459], time:0.32770634ms
          out_f32_th: [7.53855515, 50.31975555, -7.74004745], time:0.25732994ms
-------------------------------------------------------------------------------------
-------------------------------------------------------------------------------------
                                   M=2048, N=2048, K=2048
             out_f32: [61.71283722, 26.04934311, -102.72857666], time:5.15408993ms
         out_f32(sk): [61.71283722, 26.04934311, -102.72857666], time:3.65468264ms
   out_f32x4(t8x8sk): [61.71283722, 26.04934311, -102.72857666], time:0.63776970ms
          out_f32_th: [61.71292114, 26.04932785, -102.728508], time:0.46618938ms
-------------------------------------------------------------------------------------
-------------------------------------------------------------------------------------
                                   M=2048, N=4096, K=1024
             out_f32: [62.71494675, -39.81867981, 6.47817707], time:5.11722088ms
         out_f32(sk): [62.71494675, -39.81867981, 6.47817707], time:3.65266800ms
   out_f32x4(t8x8sk): [62.71494675, -39.81867981, 6.47817707], time:0.62317848ms
          out_f32_th: [62.71494675, -39.81867981, 6.47817707], time:0.52888870ms
-------------------------------------------------------------------------------------
-------------------------------------------------------------------------------------
                                   M=2048, N=4096, K=2048
             out_f32: [-27.108675, 15.58830166, -16.0705452], time:10.20850897ms
         out_f32(sk): [-27.108675, 15.58830166, -16.0705452], time:7.27157354ms
   out_f32x4(t8x8sk): [-27.108675, 15.58830166, -16.0705452], time:1.24778271ms
          out_f32_th: [-27.10868454, 15.58832741, -16.07057381], time:0.92388630ms
-------------------------------------------------------------------------------------
-------------------------------------------------------------------------------------
                                   M=4096, N=2048, K=1024
             out_f32: [35.20323181, 40.19164276, -11.43273449], time:5.12129068ms
         out_f32(sk): [35.20323181, 40.19164276, -11.43273449], time:3.65206003ms
   out_f32x4(t8x8sk): [35.20323181, 40.19164276, -11.43273449], time:0.62217474ms
          out_f32_th: [35.20323181, 40.19164276, -11.43273449], time:0.55756330ms
-------------------------------------------------------------------------------------
-------------------------------------------------------------------------------------
                                   M=4096, N=2048, K=2048
             out_f32: [33.09075546, 40.0920105, 37.22908783], time:10.21454573ms
         out_f32(sk): [33.09075546, 40.0920105, 37.22908783], time:7.26936102ms
   out_f32x4(t8x8sk): [33.09075546, 40.0920105, 37.22908783], time:1.24087334ms
          out_f32_th: [33.09081268, 40.09192657, 37.22909164], time:0.92024326ms
-------------------------------------------------------------------------------------
-------------------------------------------------------------------------------------
                                   M=4096, N=4096, K=1024
             out_f32: [-61.72018051, -61.79269791, -44.55913162], time:10.22183418ms
         out_f32(sk): [-61.72018051, -61.79269791, -44.55913162], time:7.30662346ms
   out_f32x4(t8x8sk): [-61.72018051, -61.79269791, -44.55913162], time:1.26394749ms
          out_f32_th: [-61.72018051, -61.79269791, -44.55913162], time:0.87304115ms
-------------------------------------------------------------------------------------
-------------------------------------------------------------------------------------
                                   M=4096, N=4096, K=2048
             out_f32: [62.75670624, -28.19684982, -2.13801813], time:20.37473679ms
         out_f32(sk): [62.75670624, -28.19684982, -2.13801813], time:14.59547043ms
   out_f32x4(t8x8sk): [62.75670624, -28.19684982, -2.13801813], time:2.56673336ms
          out_f32_th: [62.75670624, -28.19684982, -2.13801813], time:1.88932657ms
-------------------------------------------------------------------------------------
root@84d10136-98dc-41c0-a69b-8ff1f802b8cf:sgemm# python3 sgemm.py
-------------------------------------------------------------------------------------
                                   M=2048, N=2048, K=1024
             out_f32: [-3.6302135, -21.68153381, 38.09490585], time:2.583661ms
         out_f32(sk): [-3.6302135, -21.68153381, 38.09490585], time:1.836276ms
   out_f32x4(t8x8sk): [-3.6302135, -21.68153381, 38.09490585], time:0.324879ms
          out_f32_th: [-3.63022423, -21.68148804, 38.09489059], time:0.255821ms
-------------------------------------------------------------------------------------
-------------------------------------------------------------------------------------
                                   M=2048, N=2048, K=2048
             out_f32: [31.8502636, -43.85463333, -20.53047562], time:5.156677ms
         out_f32(sk): [31.8502636, -43.85463333, -20.53047562], time:3.653636ms
   out_f32x4(t8x8sk): [31.8502636, -43.85463333, -20.53047562], time:0.636058ms
          out_f32_th: [31.85032654, -43.85464859, -20.53049088], time:0.460682ms
-------------------------------------------------------------------------------------
-------------------------------------------------------------------------------------
                                   M=2048, N=4096, K=1024
             out_f32: [42.03569794, -2.4999752, 40.56536484], time:5.122299ms
         out_f32(sk): [42.03569794, -2.4999752, 40.56536484], time:3.651006ms
   out_f32x4(t8x8sk): [42.03569794, -2.4999752, 40.56536484], time:0.622926ms
          out_f32_th: [42.03569794, -2.4999752, 40.56536484], time:0.553234ms
-------------------------------------------------------------------------------------
-------------------------------------------------------------------------------------
                                   M=2048, N=4096, K=2048
             out_f32: [-57.71755219, 24.63807487, -17.78442574], time:10.208852ms
         out_f32(sk): [-57.71755219, 24.63807487, -17.78442574], time:7.271056ms
   out_f32x4(t8x8sk): [-57.71755219, 24.63807487, -17.78442574], time:1.245136ms
          out_f32_th: [-57.71757889, 24.63806152, -17.78441238], time:0.927131ms
-------------------------------------------------------------------------------------
-------------------------------------------------------------------------------------
                                   M=4096, N=2048, K=1024
             out_f32: [-36.51715851, 12.62567234, 21.66549492], time:5.122533ms
         out_f32(sk): [-36.51715851, 12.62567234, 21.66549492], time:3.651216ms
   out_f32x4(t8x8sk): [-36.51715851, 12.62567234, 21.66549492], time:0.622647ms
          out_f32_th: [-36.51715851, 12.62567234, 21.66549492], time:0.528753ms
-------------------------------------------------------------------------------------
-------------------------------------------------------------------------------------
                                   M=4096, N=2048, K=2048
             out_f32: [79.95121765, 20.36853981, -37.10520935], time:10.213685ms
         out_f32(sk): [79.95121765, 20.36853981, -37.10520935], time:7.269785ms
   out_f32x4(t8x8sk): [79.95121765, 20.36853981, -37.10520935], time:1.241543ms
          out_f32_th: [79.95129395, 20.36851883, -37.10521698], time:0.942338ms
-------------------------------------------------------------------------------------
-------------------------------------------------------------------------------------
                                   M=4096, N=4096, K=1024
             out_f32: [-4.90174294, -2.16196203, -15.55960083], time:10.221245ms
         out_f32(sk): [-4.90174294, -2.16196203, -15.55960083], time:7.304823ms
   out_f32x4(t8x8sk): [-4.90174294, -2.16196203, -15.55960083], time:1.263797ms
          out_f32_th: [-4.90174294, -2.16196203, -15.55960083], time:0.914106ms
-------------------------------------------------------------------------------------
-------------------------------------------------------------------------------------
                                   M=4096, N=4096, K=2048
             out_f32: [52.38516617, -20.63778496, -9.10796738], time:20.363004ms
         out_f32(sk): [52.38516617, -20.63778496, -9.10796738], time:14.592028ms
   out_f32x4(t8x8sk): [52.38516617, -20.63778496, -9.10796738], time:2.569668ms
          out_f32_th: [52.38516617, -20.63778496, -9.10796738], time:1.868989ms
-------------------------------------------------------------------------------------
```
