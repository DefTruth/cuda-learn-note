# SGEMM 

## 0x00 说明

包含以下内容：

- [X] sgemm_naive_f32_kernel 
- [X] sgemm_sliced_k_f32_kernel 
- [X] sgemm_t_8x8_sliced_k_f32x4_kernel
- [X] PyTorch bindings

## 测试

```bash
# 只测试Ada架构 不指定默认编译所有架构 耗时较长
export TORCH_CUDA_ARCH_LIST=Ada 
python3 sgemm.py
```

输出:

```bash
-------------------------------------------------------------------------------------
                                   M=512, N=128, K=128
             out_f32: [-4.44042683, 21.73293877, 14.48493576], time:0.00969887ms
         out_f32(sk): [-4.44042683, 21.73293877, 14.48493576], time:0.00712156ms
   out_f32x4(t8x8sk): [-4.44042683, 21.73293877, 14.48493576], time:0.01909018ms
          out_f32_th: [-4.44042587, 21.73294067, 14.48493958], time:0.00843048ms
-------------------------------------------------------------------------------------
-------------------------------------------------------------------------------------
                                   M=512, N=128, K=256
             out_f32: [-16.72147179, -2.18920875, 1.388901], time:0.01743913ms
         out_f32(sk): [-16.72147179, -2.18920875, 1.388901], time:0.01246572ms
   out_f32x4(t8x8sk): [-16.72147179, -2.18920875, 1.388901], time:0.03455520ms
          out_f32_th: [-16.72147179, -2.18920422, 1.38890529], time:0.01129031ms
-------------------------------------------------------------------------------------
                                   M=512, N=2048, K=128
             out_f32: [15.39400959, 9.22561073, -7.49228525], time:0.08765221ms
         out_f32(sk): [15.39400959, 9.22561073, -7.49228525], time:0.06579876ms
   out_f32x4(t8x8sk): [15.39400959, 9.22561073, -7.49228525], time:0.02172112ms
          out_f32_th: [15.39400959, 9.22561073, -7.49228525], time:0.01379728ms
-------------------------------------------------------------------------------------
-------------------------------------------------------------------------------------
                                   M=512, N=2048, K=256
             out_f32: [-10.78465557, -17.14892197, 18.31981087], time:0.17094851ms
         out_f32(sk): [-10.78465557, -17.14892197, 18.31981087], time:0.12615681ms
   out_f32x4(t8x8sk): [-10.78465557, -17.14892197, 18.31981087], time:0.03679395ms
          out_f32_th: [-10.78465557, -17.14892197, 18.31981087], time:0.02375364ms
-------------------------------------------------------------------------------------
                                   M=1024, N=128, K=512
             out_f32: [-11.6498661, -19.90281105, -6.8787694], time:0.06016254ms
         out_f32(sk): [-11.6498661, -19.90281105, -6.8787694], time:0.04313588ms
   out_f32x4(t8x8sk): [-11.6498661, -19.90281105, -6.8787694], time:0.06419182ms
          out_f32_th: [-11.64987183, -19.90282822, -6.87876606], time:0.01065135ms
-------------------------------------------------------------------------------------
-------------------------------------------------------------------------------------
                                   M=1024, N=128, K=1024
             out_f32: [-34.4461441, -21.39805603, -28.93948555], time:0.11632681ms
         out_f32(sk): [-34.4461441, -21.39805603, -28.93948555], time:0.08396864ms
   out_f32x4(t8x8sk): [-34.4461441, -21.39805603, -28.93948555], time:0.12485981ms
          out_f32_th: [-34.44618607, -21.39805603, -28.93947601], time:0.01904368ms
-------------------------------------------------------------------------------------
-------------------------------------------------------------------------------------
                                   M=1024, N=128, K=2048
             out_f32: [-21.61541176, 30.85987091, -2.31673455], time:0.22992015ms
         out_f32(sk): [-21.61541176, 30.85987091, -2.31673455], time:0.16497850ms
   out_f32x4(t8x8sk): [-21.61541176, 30.85987091, -2.31673455], time:0.24511814ms
          out_f32_th: [-21.61543655, 30.85991478, -2.31673145], time:0.02472043ms
-------------------------------------------------------------------------------------
                                   M=1024, N=4096, K=1024
             out_f32: [-25.89438438, 49.41913605, -21.64410782], time:2.58200526ms
         out_f32(sk): [-25.89438438, 49.41913605, -21.64410782], time:1.83707118ms
   out_f32x4(t8x8sk): [-25.89438438, 49.41913605, -21.64410782], time:0.32432556ms
          out_f32_th: [-25.89437485, 49.41914368, -21.64410782], time:0.26473641ms
-------------------------------------------------------------------------------------
-------------------------------------------------------------------------------------
                                   M=1024, N=4096, K=2048
             out_f32: [-4.50458622, 81.54959869, -86.19801331], time:5.14795899ms
         out_f32(sk): [-4.50458622, 81.54959869, -86.19801331], time:3.65615368ms
   out_f32x4(t8x8sk): [-4.50458622, 81.54959869, -86.19801331], time:0.64715028ms
          out_f32_th: [-4.5045929, 81.54957581, -86.19799805], time:0.48148394ms
-------------------------------------------------------------------------------------
                                   M=2048, N=1024, K=4096
             out_f32: [94.06111908, 22.52129364, -151.90014648], time:5.19625425ms
         out_f32(sk): [94.06111908, 22.52129364, -151.90014648], time:3.71586204ms
   out_f32x4(t8x8sk): [94.06111908, 22.52129364, -151.90014648], time:0.82764149ms
          out_f32_th: [94.06111908, 22.52129364, -151.90014648], time:0.54367900ms
-------------------------------------------------------------------------------------
-------------------------------------------------------------------------------------
                                   M=2048, N=2048, K=128
             out_f32: [5.65660858, 10.33701801, 11.66871643], time:0.33582091ms
         out_f32(sk): [5.65660858, 10.33701801, 11.66871643], time:0.24536967ms
   out_f32x4(t8x8sk): [5.65660858, 10.33701801, 11.66871643], time:0.05375504ms
          out_f32_th: [5.65660858, 10.33701801, 11.66871643], time:0.03742456ms
-------------------------------------------------------------------------------------
                                   M=4096, N=4096, K=256
             out_f32: [-2.82808661, 19.05683136, 10.79463196], time:2.59549618ms
         out_f32(sk): [-2.82808661, 19.05683136, 10.79463196], time:1.86207414ms
   out_f32x4(t8x8sk): [-2.82808661, 19.05683136, 10.79463196], time:0.33386588ms
          out_f32_th: [-2.82808661, 19.05683136, 10.79463196], time:0.28430223ms
-------------------------------------------------------------------------------------
-------------------------------------------------------------------------------------
                                   M=4096, N=4096, K=512
             out_f32: [-44.04353714, -35.00261307, -9.53334999], time:5.14774799ms
         out_f32(sk): [-44.04353714, -35.00261307, -9.53334999], time:3.66901159ms
   out_f32x4(t8x8sk): [-44.04353714, -35.00261307, -9.53334999], time:0.65924883ms
          out_f32_th: [-44.04353714, -35.00261307, -9.53334999], time:0.48584938ms
-------------------------------------------------------------------------------------
-------------------------------------------------------------------------------------
                                   M=4096, N=4096, K=1024
             out_f32: [-52.99743271, 11.47580814, -36.14095306], time:10.20995498ms
         out_f32(sk): [-52.99743271, 11.47580814, -36.14095306], time:7.29434729ms
   out_f32x4(t8x8sk): [-52.99743271, 11.47580814, -36.14095306], time:1.29968166ms
          out_f32_th: [-52.99743271, 11.47580814, -36.14095306], time:0.96852183ms
-------------------------------------------------------------------------------------
-------------------------------------------------------------------------------------
                                   M=4096, N=4096, K=2048
             out_f32: [33.13793945, 2.26961899, 44.48868942], time:20.40023208ms
         out_f32(sk): [33.13793945, 2.26961899, 44.48868942], time:14.58531737ms
   out_f32x4(t8x8sk): [33.13793945, 2.26961899, 44.48868942], time:2.61726856ms
          out_f32_th: [33.13793945, 2.26961899, 44.48868942], time:1.91712856ms
-------------------------------------------------------------------------------------
-------------------------------------------------------------------------------------
                                   M=4096, N=4096, K=4096
             out_f32: [135.9407959, -110.11194611, -51.80776215], time:40.75729609ms
         out_f32(sk): [135.9407959, -110.11194611, -51.80776215], time:29.12433386ms
   out_f32x4(t8x8sk): [135.9407959, -110.11194611, -51.80776215], time:5.23790836ms
          out_f32_th: [135.9407959, -110.11194611, -51.80776215], time:3.89101267ms
-------------------------------------------------------------------------------------
```
