# SGEMM 

## 0x00 说明

包含以下内容：

- [X] sgemm_naive_f32_kernel (naive)
- [X] sgemm_sliced_k_f32_kernel (sliced_k with smem)
- [X] sgemm_t_8x8_sliced_k_f32x4_kernel (thread tile 8x8)
- [X] sgemm_t_8x8_sliced_k_f32x4_bcf_kernel (bank conflicts free)
- [X] sgemm_t_8x8_sliced_k_f32x4_bcf_dbuf_kernel (bank conflicts free, double buffers)
- [X] PyTorch bindings

## 测试

```bash
# 只测试Ada架构 不指定默认编译所有架构 耗时较长: Volta, Ampere, Ada, Hopper, ...
export TORCH_CUDA_ARCH_LIST=Ada 
python3 sgemm.py
```

输出:

```bash
----------------------------------------------------------------------------------------------------
                                             M=2048, N=2048, K=1024
                    out_f32: ['-41.69404602', '-15.22974205', '12.31010342 '], time:2.583222ms
                out_f32(sk): ['-41.69404602', '-15.22974205', '12.31010342 '], time:1.836123ms
          out_f32x4(t8x8sk): ['-41.69404602', '-15.22974205', '12.31010342 '], time:0.324936ms
         out_f32x4(t8x8bcf): ['-41.69404602', '-15.22974205', '12.31010342 '], time:0.290537ms
  out_f32x4(t8x8bcf+offset): ['-41.69404602', '-15.22974205', '12.31010342 '], time:0.289106ms
        out_f32x4(t8x8dbuf): ['-41.69404602', '-15.22974205', '12.31010342 '], time:0.229044ms
 out_f32x4(t8x8dbuf+offset): ['-41.69404602', '-15.22974205', '12.31010342 '], time:0.230970ms
                 out_f32_th: ['-41.69403076', '-15.229743  ', '12.31009007 '], time:0.255721ms
----------------------------------------------------------------------------------------------------
----------------------------------------------------------------------------------------------------
                                             M=2048, N=2048, K=2048
                    out_f32: ['-11.50634861', '-30.57016182', '14.03067684 '], time:5.152175ms
                out_f32(sk): ['-11.50634861', '-30.57016182', '14.03067684 '], time:3.652353ms
          out_f32x4(t8x8sk): ['-11.50634861', '-30.57016182', '14.03067684 '], time:0.639246ms
         out_f32x4(t8x8bcf): ['-11.50634861', '-30.57016182', '14.03067684 '], time:0.576742ms
  out_f32x4(t8x8bcf+offset): ['-11.50634861', '-30.57016182', '14.03067684 '], time:0.575581ms
        out_f32x4(t8x8dbuf): ['-11.50634861', '-30.57016182', '14.03067684 '], time:0.460470ms
 out_f32x4(t8x8dbuf+offset): ['-11.50634861', '-30.57016182', '14.03067684 '], time:0.465369ms
                 out_f32_th: ['-11.50632   ', '-30.57013321', '14.03067398 '], time:0.465064ms
----------------------------------------------------------------------------------------------------
----------------------------------------------------------------------------------------------------
                                             M=2048, N=4096, K=1024
                    out_f32: ['35.35253143 ', '44.40952682 ', '-10.71832466'], time:5.122924ms
                out_f32(sk): ['35.35253143 ', '44.40952682 ', '-10.71832466'], time:3.653028ms
          out_f32x4(t8x8sk): ['35.35253143 ', '44.40952682 ', '-10.71832466'], time:0.625312ms
         out_f32x4(t8x8bcf): ['35.35253143 ', '44.40952682 ', '-10.71832466'], time:0.534370ms
  out_f32x4(t8x8bcf+offset): ['35.35253143 ', '44.40952682 ', '-10.71832466'], time:0.530348ms
        out_f32x4(t8x8dbuf): ['35.35253143 ', '44.40952682 ', '-10.71832466'], time:0.462132ms
 out_f32x4(t8x8dbuf+offset): ['35.35253143 ', '44.40952682 ', '-10.71832466'], time:0.464492ms
                 out_f32_th: ['35.35253143 ', '44.40952682 ', '-10.71832466'], time:0.557373ms
----------------------------------------------------------------------------------------------------
----------------------------------------------------------------------------------------------------
                                             M=2048, N=4096, K=2048
                    out_f32: ['61.41757584 ', '107.04826355', '37.28448868 '], time:10.218813ms
                out_f32(sk): ['61.41757584 ', '107.04826355', '37.28448868 '], time:7.268655ms
          out_f32x4(t8x8sk): ['61.41757584 ', '107.04826355', '37.28448868 '], time:1.237755ms
         out_f32x4(t8x8bcf): ['61.41757584 ', '107.04826355', '37.28448868 '], time:1.065564ms
  out_f32x4(t8x8bcf+offset): ['61.41757584 ', '107.04826355', '37.28448868 '], time:1.053824ms
        out_f32x4(t8x8dbuf): ['61.41757584 ', '107.04826355', '37.28448868 '], time:0.935848ms
 out_f32x4(t8x8dbuf+offset): ['61.41757584 ', '107.04826355', '37.28448868 '], time:0.967648ms
                 out_f32_th: ['61.41755676 ', '107.04829407', '37.28450775 '], time:0.921094ms
----------------------------------------------------------------------------------------------------
----------------------------------------------------------------------------------------------------
                                             M=4096, N=2048, K=1024
                    out_f32: ['69.17631531 ', '2.35151434  ', '14.92191601 '], time:5.120900ms
                out_f32(sk): ['69.17631531 ', '2.35151434  ', '14.92191601 '], time:3.651984ms
          out_f32x4(t8x8sk): ['69.17631531 ', '2.35151434  ', '14.92191601 '], time:0.622756ms
         out_f32x4(t8x8bcf): ['69.17631531 ', '2.35151434  ', '14.92191601 '], time:0.526509ms
  out_f32x4(t8x8bcf+offset): ['69.17631531 ', '2.35151434  ', '14.92191601 '], time:0.529506ms
        out_f32x4(t8x8dbuf): ['69.17631531 ', '2.35151434  ', '14.92191601 '], time:0.451362ms
 out_f32x4(t8x8dbuf+offset): ['69.17631531 ', '2.35151434  ', '14.92191601 '], time:0.462964ms
                 out_f32_th: ['69.17631531 ', '2.35151434  ', '14.92191601 '], time:0.552487ms
----------------------------------------------------------------------------------------------------
----------------------------------------------------------------------------------------------------
                                             M=4096, N=2048, K=2048
                    out_f32: ['62.51137161 ', '-45.17026138', '61.54212952 '], time:10.213661ms
                out_f32(sk): ['62.51137161 ', '-45.17026138', '61.54212952 '], time:7.267971ms
          out_f32x4(t8x8sk): ['62.51137161 ', '-45.17026138', '61.54212952 '], time:1.244769ms
         out_f32x4(t8x8bcf): ['62.51137161 ', '-45.17026138', '61.54212952 '], time:1.076307ms
  out_f32x4(t8x8bcf+offset): ['62.51137161 ', '-45.17026138', '61.54212952 '], time:1.074743ms
        out_f32x4(t8x8dbuf): ['62.51137161 ', '-45.17026138', '61.54212952 '], time:0.948534ms
 out_f32x4(t8x8dbuf+offset): ['62.51137161 ', '-45.17026138', '61.54212952 '], time:0.963700ms
                 out_f32_th: ['62.51136398 ', '-45.17026138', '61.54217911 '], time:0.916274ms
----------------------------------------------------------------------------------------------------
```
