# SGEMM 

## 0x00 说明

包含以下内容：

- [X] sgemm_naive_f32_kernel (naive)
- [X] sgemm_sliced_k_f32_kernel (sliced_k with smem)
- [X] sgemm_t_8x8_sliced_k_f32x4_kernel (thread tile 8x8)
- [X] sgemm_t_8x8_sliced_k_f32x4_bcf_kernel (bank conflicts free)
- [X] sgemm_t_8x8_sliced_k_f32x4_bcf_dbuf_kernel (bank conflicts free, double buffers)
- [X] PyTorch bindings

## 测试

```bash
# 只测试Ada架构 不指定默认编译所有架构 耗时较长
export TORCH_CUDA_ARCH_LIST=Ada 
python3 sgemm.py
```

输出:

```bash
-------------------------------------------------------------------------------------
                                   M=2048, N=2048, K=1024
             out_f32: [-23.44512749, 105.22006226, -72.40318298], time:2.581863ms
         out_f32(sk): [-23.44512749, 105.22006226, -72.40318298], time:1.837885ms
   out_f32x4(t8x8sk): [-23.44512749, 105.22006226, -72.40318298], time:0.325584ms
  out_f32x4(t8x8bcf): [-23.44512749, 105.22006226, -72.40318298], time:0.298755ms
 out_f32x4(t8x8dbuf): [-23.44512749, 105.22006226, -72.40318298], time:0.229251ms
          out_f32_th: [-23.44515038, 105.22006226, -72.40312958], time:0.255888ms
-------------------------------------------------------------------------------------
-------------------------------------------------------------------------------------
                                   M=2048, N=2048, K=2048
             out_f32: [4.73375559, -2.49913216, 111.71539307], time:5.155475ms
         out_f32(sk): [4.73375559, -2.49913216, 111.71539307], time:3.653073ms
   out_f32x4(t8x8sk): [4.73375559, -2.49913216, 111.71539307], time:0.635004ms
  out_f32x4(t8x8bcf): [4.73375559, -2.49913216, 111.71539307], time:0.593204ms
 out_f32x4(t8x8dbuf): [4.73375559, -2.49913216, 111.71539307], time:0.460200ms
          out_f32_th: [4.73375702, -2.49916267, 111.71534729], time:0.467465ms
-------------------------------------------------------------------------------------
-------------------------------------------------------------------------------------
                                   M=2048, N=4096, K=1024
             out_f32: [27.58790588, 18.39359474, -23.69882774], time:5.127516ms
         out_f32(sk): [27.58790588, 18.39359474, -23.69882774], time:3.652875ms
   out_f32x4(t8x8sk): [27.58790588, 18.39359474, -23.69882774], time:0.626333ms
  out_f32x4(t8x8bcf): [27.58790588, 18.39359474, -23.69882774], time:0.549185ms
 out_f32x4(t8x8dbuf): [27.58790588, 18.39359474, -23.69882774], time:0.463538ms
          out_f32_th: [27.58790588, 18.39359474, -23.69882774], time:0.555634ms
-------------------------------------------------------------------------------------
-------------------------------------------------------------------------------------
                                   M=2048, N=4096, K=2048
             out_f32: [54.19274139, -0.29313943, 26.92167664], time:10.221355ms
         out_f32(sk): [54.19274139, -0.29313943, 26.92167664], time:7.268925ms
   out_f32x4(t8x8sk): [54.19274139, -0.29313943, 26.92167664], time:1.249781ms
  out_f32x4(t8x8bcf): [54.19274139, -0.29313943, 26.92167664], time:1.119103ms
 out_f32x4(t8x8dbuf): [54.19274139, -0.29313943, 26.92167664], time:0.960808ms
          out_f32_th: [54.19275284, -0.29314613, 26.92167473], time:0.920537ms
-------------------------------------------------------------------------------------
-------------------------------------------------------------------------------------
                                   M=4096, N=2048, K=1024
             out_f32: [-37.67934418, 12.49935532, 40.71273804], time:5.120614ms
         out_f32(sk): [-37.67934418, 12.49935532, 40.71273804], time:3.652627ms
   out_f32x4(t8x8sk): [-37.67934418, 12.49935532, 40.71273804], time:0.624588ms
  out_f32x4(t8x8bcf): [-37.67934418, 12.49935532, 40.71273804], time:0.545461ms
 out_f32x4(t8x8dbuf): [-37.67934418, 12.49935532, 40.71273804], time:0.462778ms
          out_f32_th: [-37.67934418, 12.49935532, 40.71273804], time:0.560777ms
-------------------------------------------------------------------------------------
-------------------------------------------------------------------------------------
                                   M=4096, N=2048, K=2048
             out_f32: [-15.01755524, -0.44903478, 72.23948669], time:10.213506ms
         out_f32(sk): [-15.01755524, -0.44903478, 72.23948669], time:7.269592ms
   out_f32x4(t8x8sk): [-15.01755524, -0.44903478, 72.23948669], time:1.242898ms
  out_f32x4(t8x8bcf): [-15.01755524, -0.44903478, 72.23948669], time:1.099443ms
 out_f32x4(t8x8dbuf): [-15.01755524, -0.44903478, 72.23948669], time:0.941424ms
          out_f32_th: [-15.01752663, -0.44904327, 72.23952484], time:0.940223ms
-------------------------------------------------------------------------------------
-------------------------------------------------------------------------------------
                                   M=4096, N=4096, K=1024
             out_f32: [-5.76778412, 22.12718964, 17.76623344], time:10.221822ms
         out_f32(sk): [-5.76778412, 22.12718964, 17.76623344], time:7.308133ms
   out_f32x4(t8x8sk): [-5.76778412, 22.12718964, 17.76623344], time:1.263077ms
  out_f32x4(t8x8bcf): [-5.76778412, 22.12718964, 17.76623344], time:1.134577ms
 out_f32x4(t8x8dbuf): [-5.76778412, 22.12718964, 17.76623344], time:1.009488ms
          out_f32_th: [-5.76778412, 22.12718964, 17.76623344], time:0.926571ms
-------------------------------------------------------------------------------------
-------------------------------------------------------------------------------------
                                   M=4096, N=4096, K=2048
             out_f32: [35.152565, 56.02351761, 29.87486458], time:20.362103ms
         out_f32(sk): [35.152565, 56.02351761, 29.87486458], time:14.596984ms
   out_f32x4(t8x8sk): [35.152565, 56.02351761, 29.87486458], time:2.558391ms
  out_f32x4(t8x8bcf): [35.152565, 56.02351761, 29.87486458], time:2.313538ms
 out_f32x4(t8x8dbuf): [35.152565, 56.02351761, 29.87486458], time:2.144170ms
          out_f32_th: [35.152565, 56.02351761, 29.87486458], time:1.896987ms
-------------------------------------------------------------------------------------
```
