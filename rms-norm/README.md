# RMSNorm

## 0x00 说明

包含以下内容：

- [X] rms_norm_f32_kernel 
- [X] rms_norm_f32x4_kernel
- [X] rms_norm_f16_f16_kernel
- [X] rms_norm_f16x2_f16_kernel
- [X] rms_norm_f16x8_f16_kernel
- [X] rms_norm_f16x8_f32_kernel
- [X] rms_norm_f16x8_pack_f16_kernel
- [X] rms_norm_f16_f32_kernel
- [X] PyTorch bindings

## 测试

```bash
# 只测试Ada架构 不指定默认编译所有架构 耗时较长
export TORCH_CUDA_ARCH_LIST=Ada 
python3 rms_norm.py
```

输出:

```bash
-------------------------------------------------------------------------------------
                                        N=4096, K=512
          out_f32: ['-1.29733324 ', '-0.24534962 ', '0.28908193  '], time:0.01198888ms
        out_f32x4: ['-1.29733312 ', '-0.24534959 ', '0.2890819   '], time:0.00516200ms
       out_f32_th: ['-1.29733992 ', '-0.24535085 ', '0.28908339  '], time:0.04218650ms
-------------------------------------------------------------------------------------
       out_f16f16: ['-1.29785156 ', '-0.24536133 ', '0.28881836  '], time:0.01201439ms
       out_f16f32: ['-1.29785156 ', '-0.24536133 ', '0.2890625   '], time:0.01185226ms
     out_f16x2f16: ['-1.29785156 ', '-0.24536133 ', '0.28881836  '], time:0.00675559ms
     out_f16x8f16: ['-1.29785156 ', '-0.24536133 ', '0.28881836  '], time:0.00411868ms
     out_f16x8f32: ['-1.29785156 ', '-0.24536133 ', '0.28881836  '], time:0.00412631ms
 out_f16x8packf16: ['-1.29785156 ', '-0.24536133 ', '0.28881836  '], time:0.00410247ms
       out_f16_th: ['-1.29785156 ', '-0.24536133 ', '0.28881836  '], time:0.04640508ms
-------------------------------------------------------------------------------------
-------------------------------------------------------------------------------------
                                        N=4096, K=1024
          out_f32: ['0.7394619   ', '-1.30663371 ', '-0.89935279 '], time:0.03392005ms
        out_f32x4: ['0.7394619   ', '-1.30663371 ', '-0.89935279 '], time:0.00862861ms
       out_f32_th: ['0.73946548  ', '-1.30664003 ', '-0.89935714 '], time:0.04181147ms
-------------------------------------------------------------------------------------
       out_f16f16: ['0.73974609  ', '-1.30761719 ', '-0.89990234 '], time:0.03532362ms
       out_f16f32: ['0.73925781  ', '-1.30664062 ', '-0.89941406 '], time:0.03308058ms
     out_f16x2f16: ['0.73974609  ', '-1.30761719 ', '-0.89990234 '], time:0.01217198ms
     out_f16x8f16: ['0.73974609  ', '-1.30761719 ', '-0.89990234 '], time:0.00630593ms
     out_f16x8f32: ['0.73974609  ', '-1.30761719 ', '-0.89990234 '], time:0.00630307ms
 out_f16x8packf16: ['0.73974609  ', '-1.30761719 ', '-0.89990234 '], time:0.00526261ms
       out_f16_th: ['0.73925781  ', '-1.30664062 ', '-0.89941406 '], time:0.04207253ms
-------------------------------------------------------------------------------------
-------------------------------------------------------------------------------------
                                        N=4096, K=2048
        out_f32x4: ['1.14549768  ', '0.53831083  ', '0.3144384   '], time:0.01655984ms
       out_f32_th: ['1.14550304  ', '0.53831333  ', '0.31443989  '], time:0.09450102ms
-------------------------------------------------------------------------------------
     out_f16x2f16: ['1.14648438  ', '0.53857422  ', '0.31445312  '], time:0.03498554ms
     out_f16x8f16: ['1.14648438  ', '0.53857422  ', '0.31445312  '], time:0.01252484ms
     out_f16x8f32: ['1.14648438  ', '0.53857422  ', '0.31445312  '], time:0.01252151ms
 out_f16x8packf16: ['1.14550781  ', '0.53808594  ', '0.31420898  '], time:0.00900769ms
       out_f16_th: ['1.14648438  ', '0.53857422  ', '0.31445312  '], time:0.04877210ms
-------------------------------------------------------------------------------------
-------------------------------------------------------------------------------------
                                        N=4096, K=4096
        out_f32x4: ['1.01179266  ', '1.11758173  ', '-0.92136633 '], time:0.18797612ms
       out_f32_th: ['1.01179767  ', '1.11758733  ', '-0.92137086 '], time:0.52547622ms
-------------------------------------------------------------------------------------
     out_f16x8f16: ['1.01269531  ', '1.11816406  ', '-0.92138672 '], time:0.03602028ms
     out_f16x8f32: ['1.01269531  ', '1.11816406  ', '-0.92138672 '], time:0.03603482ms
 out_f16x8packf16: ['1.01269531  ', '1.11816406  ', '-0.92138672 '], time:0.01717544ms
       out_f16_th: ['1.01171875  ', '1.1171875   ', '-0.92138672 '], time:0.11144495ms
-------------------------------------------------------------------------------------
-------------------------------------------------------------------------------------
                                        N=4096, K=8192
     out_f16x8f16: ['1.76269531  ', '-0.85791016 ', '0.72753906  '], time:0.19304371ms
     out_f16x8f32: ['1.76269531  ', '-0.85791016 ', '0.72753906  '], time:0.19298697ms
 out_f16x8packf16: ['1.76269531  ', '-0.85791016 ', '0.72753906  '], time:0.18492079ms
       out_f16_th: ['1.76171875  ', '-0.85791016 ', '0.72705078  '], time:0.59564757ms
-------------------------------------------------------------------------------------
-------------------------------------------------------------------------------------
                                        N=8192, K=8192
     out_f16x8f16: ['-0.0824585  ', '-0.03363037 ', '-0.00045943 '], time:0.38219976ms
     out_f16x8f32: ['-0.0824585  ', '-0.03363037 ', '-0.00045943 '], time:0.38202691ms
 out_f16x8packf16: ['-0.08239746 ', '-0.03359985 ', '-0.00045896 '], time:0.40786862ms
       out_f16_th: ['-0.0824585  ', '-0.03363037 ', '-0.00045943 '], time:1.35813046ms
-------------------------------------------------------------------------------------
```
