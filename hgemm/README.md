# HGEMM 

## 0x00 说明

包含以下内容：

- [X] hgemm_sliced_k_f16_kernel 
- [X] hgemm_t_8x8_sliced_k_f16x4_kernel(unpack)
- [X] hgemm_t_8x8_sliced_k_f16x4_pack_kernel(pack 16x4)
- [X] hgemm_t_8x8_sliced_k_f16x4_bcf_kernel(bank conflicts reduce)
- [X] hgemm_t_8x8_sliced_k_f16x4_pack_bcf_kernel(bank conflicts reduce, pack)
- [X] hgemm_t_4x4_sliced_k_f16x4_pack_bcf_kernel(bank conflicts reduce, pack)
- [X] hgemm_t_8x8_sliced_k_f16x8_pack_bcf_kernel(bank conflicts reduce, pack)
- [X] PyTorch bindings

## 共享内存 Bank Conflicts

含义：在访问shared memory时，因多个线程读写同一个Bank中的不同数据地址时，导致shared memory 并发读写 退化 成顺序读写的现象叫做Bank Conflict；

![](https://github.com/PaddleJitLab/CUDATutorial/blob/develop/docs/09_optimize_reduce/02_bank_conflict/images/ef322be7c3e5b6b9be69d2b90e88083f50569a58a97129f348e483b946ab4edf.png)

SM调度单位为一个warp（一个warp内32个Thread），shared_memory 可以 被一个warp中的所有（32个）线程进行访问，shared_memory 映射到大小相等的32个Bank上，Bank的数据读取带宽为32bit / cycle (4 bytes)，因此，主要需要考虑一个Warp内32线程的访问共享内存时的bank冲突。
对于多个线程读取同一个Bank数据时（不同地址），硬件把内存读写请求，拆分成 conflict-free requests，进行顺序读写，此时将会触发多次内存事务。特别地，当一个warp中的所有线程读写同一个地址时，会触发broadcast机制，此时不会退化成顺序读写。上面提到触发broadcast机制的条件是all threads acess same address，但在翻阅cuda-c-programming-guide以及最新版本的[NVProfGuide](https://docs.nvidia.com/nsight-compute/ProfilingGuide/index.html) 时，发现只要是多个thread 读写就会触发broadcast（不需要All）。
  
- 多个线程读同一个数据时，仅有一个线程读，然后broadcast到其他线程
- 多个线程写同一个数据时，仅会有一个线程写成功

[Using Shared Memory in CUDA C/C++](https://developer.nvidia.com/blog/using-shared-memory-cuda-cc/)中指出，我们还可以通过 `cudaDeviceSetSharedMemConfig()` 函数设置默认Bank Size（默认为4 bytes）来避免bank conflicts，可设置为cudaSharedMemBankSizeFourByte或者cudaSharedMemBankSizeEightByte。对于某些场景来说，设置cudaSharedMemBankSizeEightByte或许更合格式。

## 参考文献 

- [CUDA编程概念】一、什么是bank conflict？](https://zhuanlan.zhihu.com/p/659142274)
- [解决 bank conflict](https://github.com/PaddleJitLab/CUDATutorial/blob/develop/docs/09_optimize_reduce/02_bank_conflict/README.md)
- [Bank Conflict free 的几种方式](https://zhuanlan.zhihu.com/p/722286440)
- [Using Shared Memory in CUDA C/C++](https://developer.nvidia.com/blog/using-shared-memory-cuda-cc/)

## 测试

```bash
# 只测试Ada架构 不指定默认编译所有架构 耗时较长: Volta, Ampere, Ada, Hopper, ...
export TORCH_CUDA_ARCH_LIST=Ada 
python3 hgemm.py
```

输出:

```bash
--------------------------------------------------------------------------------------------------------------
                                             M=1024, N=1024, K=256
                         out_f16: ['21.484375   ', '-1.95996094 ', '-3.66210938 '], time:0.162156ms
                     out_f16(sk): ['21.484375   ', '-1.95996094 ', '-3.66210938 '], time:0.121964ms
          out_f16x4pack(t4x4bcf): ['21.484375   ', '-1.95996094 ', '-3.66210938 '], time:0.021611ms
       out_f16x4pack(t4x4offset): ['21.484375   ', '-1.95996094 ', '-3.66210938 '], time:0.021212ms
               out_f16x4(t8x8sk): ['21.484375   ', '-1.95996094 ', '-3.66210938 '], time:0.028727ms
              out_f16x4(t8x8bcf): ['21.484375   ', '-1.95996094 ', '-3.66210938 '], time:0.025299ms
           out_f16x4pack(t8x8sk): ['21.484375   ', '-1.95996094 ', '-3.66210938 '], time:0.026134ms
              out_f16x4pack(bcf): ['21.484375   ', '-1.95996094 ', '-3.66210938 '], time:0.023820ms
           out_f16x4pack(offset): ['21.484375   ', '-1.95996094 ', '-3.66210938 '], time:0.023861ms
              out_f16x8pack(bcf): ['21.484375   ', '-1.95996094 ', '-3.66210938 '], time:0.023755ms
           out_f16x8pack(offset): ['21.484375   ', '-1.95996094 ', '-3.66210938 '], time:0.023767ms
                      out_f16_th: ['21.453125   ', '-2.02734375 ', '-3.62304688 '], time:0.010352ms
--------------------------------------------------------------------------------------------------------------
--------------------------------------------------------------------------------------------------------------
                                             M=1024, N=1024, K=512
                         out_f16: ['12.0546875  ', '25.71875    ', '46.0        '], time:0.319458ms
                     out_f16(sk): ['12.0546875  ', '25.71875    ', '46.0        '], time:0.238683ms
          out_f16x4pack(t4x4bcf): ['12.0546875  ', '25.71875    ', '46.0        '], time:0.041040ms
       out_f16x4pack(t4x4offset): ['12.0546875  ', '25.71875    ', '46.0        '], time:0.040317ms
               out_f16x4(t8x8sk): ['12.0546875  ', '25.71875    ', '46.0        '], time:0.052266ms
              out_f16x4(t8x8bcf): ['12.0546875  ', '25.71875    ', '46.0        '], time:0.048014ms
           out_f16x4pack(t8x8sk): ['12.0546875  ', '25.71875    ', '46.0        '], time:0.048636ms
              out_f16x4pack(bcf): ['12.0546875  ', '25.71875    ', '46.0        '], time:0.045189ms
           out_f16x4pack(offset): ['12.0546875  ', '25.71875    ', '46.0        '], time:0.045024ms
              out_f16x8pack(bcf): ['12.0546875  ', '25.71875    ', '46.0        '], time:0.045140ms
           out_f16x8pack(offset): ['12.0546875  ', '25.71875    ', '46.0        '], time:0.045192ms
                      out_f16_th: ['12.0703125  ', '25.734375   ', '45.75       '], time:0.016851ms
--------------------------------------------------------------------------------------------------------------
--------------------------------------------------------------------------------------------------------------
                                             M=1024, N=1024, K=1024
                         out_f16: ['62.8125     ', '-33.75      ', '36.90625    '], time:0.634046ms
                     out_f16(sk): ['62.8125     ', '-33.75      ', '36.90625    '], time:0.471801ms
          out_f16x4pack(t4x4bcf): ['62.8125     ', '-33.75      ', '36.90625    '], time:0.079749ms
       out_f16x4pack(t4x4offset): ['62.8125     ', '-33.75      ', '36.90625    '], time:0.078303ms
               out_f16x4(t8x8sk): ['62.8125     ', '-33.75      ', '36.90625    '], time:0.099667ms
              out_f16x4(t8x8bcf): ['62.8125     ', '-33.75      ', '36.90625    '], time:0.093594ms
           out_f16x4pack(t8x8sk): ['62.8125     ', '-33.75      ', '36.90625    '], time:0.093852ms
              out_f16x4pack(bcf): ['62.8125     ', '-33.75      ', '36.90625    '], time:0.087847ms
           out_f16x4pack(offset): ['62.8125     ', '-33.75      ', '36.90625    '], time:0.087496ms
              out_f16x8pack(bcf): ['62.8125     ', '-33.75      ', '36.90625    '], time:0.087731ms
           out_f16x8pack(offset): ['62.8125     ', '-33.75      ', '36.90625    '], time:0.087965ms
                      out_f16_th: ['62.65625    ', '-33.96875   ', '36.8125     '], time:0.029954ms
--------------------------------------------------------------------------------------------------------------
--------------------------------------------------------------------------------------------------------------
                                             M=1024, N=2048, K=256
                         out_f16: ['1.30273438  ', '-9.2109375  ', '-33.375     '], time:0.309604ms
                     out_f16(sk): ['1.30273438  ', '-9.2109375  ', '-33.375     '], time:0.232643ms
          out_f16x4pack(t4x4bcf): ['1.30273438  ', '-9.2109375  ', '-33.375     '], time:0.037819ms
       out_f16x4pack(t4x4offset): ['1.30273438  ', '-9.2109375  ', '-33.375     '], time:0.037167ms
               out_f16x4(t8x8sk): ['1.30273438  ', '-9.2109375  ', '-33.375     '], time:0.045149ms
              out_f16x4(t8x8bcf): ['1.30273438  ', '-9.2109375  ', '-33.375     '], time:0.041175ms
           out_f16x4pack(t8x8sk): ['1.30273438  ', '-9.2109375  ', '-33.375     '], time:0.040584ms
              out_f16x4pack(bcf): ['1.30273438  ', '-9.2109375  ', '-33.375     '], time:0.038208ms
           out_f16x4pack(offset): ['1.30273438  ', '-9.2109375  ', '-33.375     '], time:0.038253ms
              out_f16x8pack(bcf): ['1.30273438  ', '-9.2109375  ', '-33.375     '], time:0.036594ms
           out_f16x8pack(offset): ['1.30273438  ', '-9.2109375  ', '-33.375     '], time:0.036381ms
                      out_f16_th: ['1.28808594  ', '-9.21875    ', '-33.5       '], time:0.018030ms
--------------------------------------------------------------------------------------------------------------
--------------------------------------------------------------------------------------------------------------
                                             M=1024, N=2048, K=512
                         out_f16: ['-33.40625   ', '-26.4375    ', '-9.6953125  '], time:0.611522ms
                     out_f16(sk): ['-33.40625   ', '-26.4375    ', '-9.6953125  '], time:0.456609ms
          out_f16x4pack(t4x4bcf): ['-33.40625   ', '-26.4375    ', '-9.6953125  '], time:0.073241ms
       out_f16x4pack(t4x4offset): ['-33.40625   ', '-26.4375    ', '-9.6953125  '], time:0.071995ms
               out_f16x4(t8x8sk): ['-33.40625   ', '-26.4375    ', '-9.6953125  '], time:0.084352ms
              out_f16x4(t8x8bcf): ['-33.40625   ', '-26.4375    ', '-9.6953125  '], time:0.079296ms
           out_f16x4pack(t8x8sk): ['-33.40625   ', '-26.4375    ', '-9.6953125  '], time:0.077518ms
              out_f16x4pack(bcf): ['-33.40625   ', '-26.4375    ', '-9.6953125  '], time:0.073532ms
           out_f16x4pack(offset): ['-33.40625   ', '-26.4375    ', '-9.6953125  '], time:0.073690ms
              out_f16x8pack(bcf): ['-33.40625   ', '-26.4375    ', '-9.6953125  '], time:0.070404ms
           out_f16x8pack(offset): ['-33.40625   ', '-26.4375    ', '-9.6953125  '], time:0.069838ms
                      out_f16_th: ['-33.46875   ', '-26.546875  ', '-9.671875   '], time:0.031267ms
--------------------------------------------------------------------------------------------------------------
--------------------------------------------------------------------------------------------------------------
                                             M=1024, N=2048, K=1024
                         out_f16: ['-77.9375    ', '25.234375   ', '-32.25      '], time:1.215316ms
                     out_f16(sk): ['-77.9375    ', '25.234375   ', '-32.25      '], time:0.904359ms
          out_f16x4pack(t4x4bcf): ['-77.9375    ', '25.234375   ', '-32.25      '], time:0.145146ms
       out_f16x4pack(t4x4offset): ['-77.9375    ', '25.234375   ', '-32.25      '], time:0.142806ms
               out_f16x4(t8x8sk): ['-77.9375    ', '25.234375   ', '-32.25      '], time:0.162499ms
              out_f16x4(t8x8bcf): ['-77.9375    ', '25.234375   ', '-32.25      '], time:0.155442ms
           out_f16x4pack(t8x8sk): ['-77.9375    ', '25.234375   ', '-32.25      '], time:0.151216ms
              out_f16x4pack(bcf): ['-77.9375    ', '25.234375   ', '-32.25      '], time:0.144004ms
           out_f16x4pack(offset): ['-77.9375    ', '25.234375   ', '-32.25      '], time:0.144379ms
              out_f16x8pack(bcf): ['-77.9375    ', '25.234375   ', '-32.25      '], time:0.137974ms
           out_f16x8pack(offset): ['-77.9375    ', '25.234375   ', '-32.25      '], time:0.136572ms
                      out_f16_th: ['-78.0       ', '25.09375    ', '-32.15625   '], time:0.057608ms
--------------------------------------------------------------------------------------------------------------
--------------------------------------------------------------------------------------------------------------
                                             M=1024, N=4096, K=256
                         out_f16: ['-3.01171875 ', '-1.85058594 ', '-8.6796875  '], time:0.606133ms
                     out_f16(sk): ['-3.01171875 ', '-1.85058594 ', '-8.6796875  '], time:0.454601ms
          out_f16x4pack(t4x4bcf): ['-3.01171875 ', '-1.85058594 ', '-8.6796875  '], time:0.070374ms
       out_f16x4pack(t4x4offset): ['-3.01171875 ', '-1.85058594 ', '-8.6796875  '], time:0.069029ms
               out_f16x4(t8x8sk): ['-3.01171875 ', '-1.85058594 ', '-8.6796875  '], time:0.065957ms
              out_f16x4(t8x8bcf): ['-3.01171875 ', '-1.85058594 ', '-8.6796875  '], time:0.057919ms
           out_f16x4pack(t8x8sk): ['-3.01171875 ', '-1.85058594 ', '-8.6796875  '], time:0.058044ms
              out_f16x4pack(bcf): ['-3.01171875 ', '-1.85058594 ', '-8.6796875  '], time:0.053713ms
           out_f16x4pack(offset): ['-3.01171875 ', '-1.85058594 ', '-8.6796875  '], time:0.053627ms
              out_f16x8pack(bcf): ['-3.01171875 ', '-1.85058594 ', '-8.6796875  '], time:0.052321ms
           out_f16x8pack(offset): ['-3.01171875 ', '-1.85058594 ', '-8.6796875  '], time:0.051835ms
                      out_f16_th: ['-3.00390625 ', '-1.84277344 ', '-8.6640625  '], time:0.025358ms
--------------------------------------------------------------------------------------------------------------
--------------------------------------------------------------------------------------------------------------
                                             M=1024, N=4096, K=512
                         out_f16: ['-9.0625     ', '8.828125    ', '-13.2265625 '], time:1.198144ms
                     out_f16(sk): ['-9.0625     ', '8.828125    ', '-13.2265625 '], time:0.893668ms
          out_f16x4pack(t4x4bcf): ['-9.0625     ', '8.828125    ', '-13.2265625 '], time:0.139338ms
       out_f16x4pack(t4x4offset): ['-9.0625     ', '8.828125    ', '-13.2265625 '], time:0.136840ms
               out_f16x4(t8x8sk): ['-9.0625     ', '8.828125    ', '-13.2265625 '], time:0.120734ms
              out_f16x4(t8x8bcf): ['-9.0625     ', '8.828125    ', '-13.2265625 '], time:0.111685ms
           out_f16x4pack(t8x8sk): ['-9.0625     ', '8.828125    ', '-13.2265625 '], time:0.110269ms
              out_f16x4pack(bcf): ['-9.0625     ', '8.828125    ', '-13.2265625 '], time:0.103436ms
           out_f16x4pack(offset): ['-9.0625     ', '8.828125    ', '-13.2265625 '], time:0.103198ms
              out_f16x8pack(bcf): ['-9.0625     ', '8.828125    ', '-13.2265625 '], time:0.100174ms
           out_f16x8pack(offset): ['-9.0625     ', '8.828125    ', '-13.2265625 '], time:0.099486ms
                      out_f16_th: ['-9.0078125  ', '8.78125     ', '-13.1875    '], time:0.044984ms
--------------------------------------------------------------------------------------------------------------
--------------------------------------------------------------------------------------------------------------
                                             M=1024, N=4096, K=1024
                         out_f16: ['-29.015625  ', '5.1484375   ', '14.8828125  '], time:2.382674ms
                     out_f16(sk): ['-29.015625  ', '5.1484375   ', '14.8828125  '], time:1.771703ms
          out_f16x4pack(t4x4bcf): ['-29.015625  ', '5.1484375   ', '14.8828125  '], time:0.277116ms
       out_f16x4pack(t4x4offset): ['-29.015625  ', '5.1484375   ', '14.8828125  '], time:0.273381ms
               out_f16x4(t8x8sk): ['-29.015625  ', '5.1484375   ', '14.8828125  '], time:0.231652ms
              out_f16x4(t8x8bcf): ['-29.015625  ', '5.1484375   ', '14.8828125  '], time:0.219471ms
           out_f16x4pack(t8x8sk): ['-29.015625  ', '5.1484375   ', '14.8828125  '], time:0.215337ms
              out_f16x4pack(bcf): ['-29.015625  ', '5.1484375   ', '14.8828125  '], time:0.202957ms
           out_f16x4pack(offset): ['-29.015625  ', '5.1484375   ', '14.8828125  '], time:0.202289ms
              out_f16x8pack(bcf): ['-29.015625  ', '5.1484375   ', '14.8828125  '], time:0.196815ms
           out_f16x8pack(offset): ['-29.015625  ', '5.1484375   ', '14.8828125  '], time:0.195075ms
                      out_f16_th: ['-29.0625    ', '5.1015625   ', '14.984375   '], time:0.084119ms
--------------------------------------------------------------------------------------------------------------
--------------------------------------------------------------------------------------------------------------
                                             M=2048, N=1024, K=256
                         out_f16: ['22.59375    ', '25.15625    ', '20.390625   '], time:0.309613ms
                     out_f16(sk): ['22.59375    ', '25.15625    ', '20.390625   '], time:0.232681ms
          out_f16x4pack(t4x4bcf): ['22.59375    ', '25.15625    ', '20.390625   '], time:0.037872ms
       out_f16x4pack(t4x4offset): ['22.59375    ', '25.15625    ', '20.390625   '], time:0.037215ms
               out_f16x4(t8x8sk): ['22.59375    ', '25.15625    ', '20.390625   '], time:0.044645ms
              out_f16x4(t8x8bcf): ['22.59375    ', '25.15625    ', '20.390625   '], time:0.041085ms
           out_f16x4pack(t8x8sk): ['22.59375    ', '25.15625    ', '20.390625   '], time:0.040396ms
              out_f16x4pack(bcf): ['22.59375    ', '25.15625    ', '20.390625   '], time:0.038233ms
           out_f16x4pack(offset): ['22.59375    ', '25.15625    ', '20.390625   '], time:0.038226ms
              out_f16x8pack(bcf): ['22.59375    ', '25.15625    ', '20.390625   '], time:0.036567ms
           out_f16x8pack(offset): ['22.59375    ', '25.15625    ', '20.390625   '], time:0.036368ms
                      out_f16_th: ['22.59375    ', '25.140625   ', '20.40625    '], time:0.018016ms
--------------------------------------------------------------------------------------------------------------
--------------------------------------------------------------------------------------------------------------
                                             M=2048, N=1024, K=512
                         out_f16: ['-20.421875  ', '3.49023438  ', '32.1875     '], time:0.611553ms
                     out_f16(sk): ['-20.421875  ', '3.49023438  ', '32.1875     '], time:0.456971ms
          out_f16x4pack(t4x4bcf): ['-20.421875  ', '3.49023438  ', '32.1875     '], time:0.073360ms
       out_f16x4pack(t4x4offset): ['-20.421875  ', '3.49023438  ', '32.1875     '], time:0.071994ms
               out_f16x4(t8x8sk): ['-20.421875  ', '3.49023438  ', '32.1875     '], time:0.083932ms
              out_f16x4(t8x8bcf): ['-20.421875  ', '3.49023438  ', '32.1875     '], time:0.079230ms
           out_f16x4pack(t8x8sk): ['-20.421875  ', '3.49023438  ', '32.1875     '], time:0.077116ms
              out_f16x4pack(bcf): ['-20.421875  ', '3.49023438  ', '32.1875     '], time:0.073698ms
           out_f16x4pack(offset): ['-20.421875  ', '3.49023438  ', '32.1875     '], time:0.073669ms
              out_f16x8pack(bcf): ['-20.421875  ', '3.49023438  ', '32.1875     '], time:0.070330ms
           out_f16x8pack(offset): ['-20.421875  ', '3.49023438  ', '32.1875     '], time:0.069845ms
                      out_f16_th: ['-20.4375    ', '3.50976562  ', '32.1875     '], time:0.031190ms
--------------------------------------------------------------------------------------------------------------
--------------------------------------------------------------------------------------------------------------
                                             M=2048, N=1024, K=1024
                         out_f16: ['-11.984375  ', '13.859375   ', '3.01367188  '], time:1.215566ms
                     out_f16(sk): ['-11.984375  ', '13.859375   ', '3.01367188  '], time:0.904491ms
          out_f16x4pack(t4x4bcf): ['-11.984375  ', '13.859375   ', '3.01367188  '], time:0.145355ms
       out_f16x4pack(t4x4offset): ['-11.984375  ', '13.859375   ', '3.01367188  '], time:0.142924ms
               out_f16x4(t8x8sk): ['-11.984375  ', '13.859375   ', '3.01367188  '], time:0.162164ms
              out_f16x4(t8x8bcf): ['-11.984375  ', '13.859375   ', '3.01367188  '], time:0.155778ms
           out_f16x4pack(t8x8sk): ['-11.984375  ', '13.859375   ', '3.01367188  '], time:0.150889ms
              out_f16x4pack(bcf): ['-11.984375  ', '13.859375   ', '3.01367188  '], time:0.144444ms
           out_f16x4pack(offset): ['-11.984375  ', '13.859375   ', '3.01367188  '], time:0.144348ms
              out_f16x8pack(bcf): ['-11.984375  ', '13.859375   ', '3.01367188  '], time:0.138090ms
           out_f16x8pack(offset): ['-11.984375  ', '13.859375   ', '3.01367188  '], time:0.136937ms
                      out_f16_th: ['-11.9296875 ', '13.9140625  ', '3.02148438  '], time:0.057563ms
--------------------------------------------------------------------------------------------------------------
--------------------------------------------------------------------------------------------------------------
                                             M=2048, N=2048, K=256
                         out_f16: ['8.8203125   ', '-3.16601562 ', '13.7265625  '], time:0.606369ms
                     out_f16(sk): ['8.8203125   ', '-3.16601562 ', '13.7265625  '], time:0.455201ms
          out_f16x4pack(t4x4bcf): ['8.8203125   ', '-3.16601562 ', '13.7265625  '], time:0.070472ms
       out_f16x4pack(t4x4offset): ['8.8203125   ', '-3.16601562 ', '13.7265625  '], time:0.069127ms
               out_f16x4(t8x8sk): ['8.8203125   ', '-3.16601562 ', '13.7265625  '], time:0.067195ms
              out_f16x4(t8x8bcf): ['8.8203125   ', '-3.16601562 ', '13.7265625  '], time:0.057917ms
           out_f16x4pack(t8x8sk): ['8.8203125   ', '-3.16601562 ', '13.7265625  '], time:0.058713ms
              out_f16x4pack(bcf): ['8.8203125   ', '-3.16601562 ', '13.7265625  '], time:0.053779ms
           out_f16x4pack(offset): ['8.8203125   ', '-3.16601562 ', '13.7265625  '], time:0.053728ms
              out_f16x8pack(bcf): ['8.8203125   ', '-3.16601562 ', '13.7265625  '], time:0.052478ms
           out_f16x8pack(offset): ['8.8203125   ', '-3.16601562 ', '13.7265625  '], time:0.052156ms
                      out_f16_th: ['8.8359375   ', '-3.15820312 ', '13.71875    '], time:0.025408ms
--------------------------------------------------------------------------------------------------------------
--------------------------------------------------------------------------------------------------------------
                                             M=2048, N=2048, K=512
                         out_f16: ['-12.1328125 ', '-3.8203125  ', '15.4375     '], time:1.198213ms
                     out_f16(sk): ['-12.1328125 ', '-3.8203125  ', '15.4375     '], time:0.894974ms
          out_f16x4pack(t4x4bcf): ['-12.1328125 ', '-3.8203125  ', '15.4375     '], time:0.139549ms
       out_f16x4pack(t4x4offset): ['-12.1328125 ', '-3.8203125  ', '15.4375     '], time:0.137022ms
               out_f16x4(t8x8sk): ['-12.1328125 ', '-3.8203125  ', '15.4375     '], time:0.122213ms
              out_f16x4(t8x8bcf): ['-12.1328125 ', '-3.8203125  ', '15.4375     '], time:0.111684ms
           out_f16x4pack(t8x8sk): ['-12.1328125 ', '-3.8203125  ', '15.4375     '], time:0.111181ms
              out_f16x4pack(bcf): ['-12.1328125 ', '-3.8203125  ', '15.4375     '], time:0.103350ms
           out_f16x4pack(offset): ['-12.1328125 ', '-3.8203125  ', '15.4375     '], time:0.103209ms
              out_f16x8pack(bcf): ['-12.1328125 ', '-3.8203125  ', '15.4375     '], time:0.100302ms
           out_f16x8pack(offset): ['-12.1328125 ', '-3.8203125  ', '15.4375     '], time:0.100054ms
                      out_f16_th: ['-12.1328125 ', '-3.82421875 ', '15.46875    '], time:0.045010ms
--------------------------------------------------------------------------------------------------------------
--------------------------------------------------------------------------------------------------------------
                                             M=2048, N=2048, K=1024
                         out_f16: ['22.96875    ', '47.6875     ', '34.40625    '], time:2.382358ms
                     out_f16(sk): ['22.96875    ', '47.6875     ', '34.40625    '], time:1.773636ms
          out_f16x4pack(t4x4bcf): ['22.96875    ', '47.6875     ', '34.40625    '], time:0.277883ms
       out_f16x4pack(t4x4offset): ['22.96875    ', '47.6875     ', '34.40625    '], time:0.273660ms
               out_f16x4(t8x8sk): ['22.96875    ', '47.6875     ', '34.40625    '], time:0.233389ms
              out_f16x4(t8x8bcf): ['22.96875    ', '47.6875     ', '34.40625    '], time:0.219998ms
           out_f16x4pack(t8x8sk): ['22.96875    ', '47.6875     ', '34.40625    '], time:0.216918ms
              out_f16x4pack(bcf): ['22.96875    ', '47.6875     ', '34.40625    '], time:0.203171ms
           out_f16x4pack(offset): ['22.96875    ', '47.6875     ', '34.40625    '], time:0.202978ms
              out_f16x8pack(bcf): ['22.96875    ', '47.6875     ', '34.40625    '], time:0.197327ms
           out_f16x8pack(offset): ['22.96875    ', '47.6875     ', '34.40625    '], time:0.196782ms
                      out_f16_th: ['23.0        ', '47.78125    ', '34.34375    '], time:0.084282ms
--------------------------------------------------------------------------------------------------------------
--------------------------------------------------------------------------------------------------------------
                                             M=2048, N=4096, K=256
                         out_f16: ['0.83447266  ', '1.921875    ', '2.62890625  '], time:1.204888ms
                     out_f16(sk): ['0.83447266  ', '1.921875    ', '2.62890625  '], time:0.903167ms
          out_f16x4pack(t4x4bcf): ['0.83447266  ', '1.921875    ', '2.62890625  '], time:0.130934ms
       out_f16x4pack(t4x4offset): ['0.83447266  ', '1.921875    ', '2.62890625  '], time:0.128506ms
               out_f16x4(t8x8sk): ['0.83447266  ', '1.921875    ', '2.62890625  '], time:0.124031ms
              out_f16x4(t8x8bcf): ['0.83447266  ', '1.921875    ', '2.62890625  '], time:0.108457ms
           out_f16x4pack(t8x8sk): ['0.83447266  ', '1.921875    ', '2.62890625  '], time:0.108359ms
              out_f16x4pack(bcf): ['0.83447266  ', '1.921875    ', '2.62890625  '], time:0.099940ms
           out_f16x4pack(offset): ['0.83447266  ', '1.921875    ', '2.62890625  '], time:0.099585ms
              out_f16x8pack(bcf): ['0.83447266  ', '1.921875    ', '2.62890625  '], time:0.096716ms
           out_f16x8pack(offset): ['0.83447266  ', '1.921875    ', '2.62890625  '], time:0.095844ms
                      out_f16_th: ['0.82666016  ', '1.90039062  ', '2.66015625  '], time:0.046674ms
--------------------------------------------------------------------------------------------------------------
--------------------------------------------------------------------------------------------------------------
                                             M=2048, N=4096, K=512
                         out_f16: ['-38.25      ', '8.1484375   ', '35.84375    '], time:2.383915ms
                     out_f16(sk): ['-38.25      ', '8.1484375   ', '35.84375    '], time:1.776247ms
          out_f16x4pack(t4x4bcf): ['-38.25      ', '8.1484375   ', '35.84375    '], time:0.259576ms
       out_f16x4pack(t4x4offset): ['-38.25      ', '8.1484375   ', '35.84375    '], time:0.255759ms
               out_f16x4(t8x8sk): ['-38.25      ', '8.1484375   ', '35.84375    '], time:0.231398ms
              out_f16x4(t8x8bcf): ['-38.25      ', '8.1484375   ', '35.84375    '], time:0.211641ms
           out_f16x4pack(t8x8sk): ['-38.25      ', '8.1484375   ', '35.84375    '], time:0.208231ms
              out_f16x4pack(bcf): ['-38.25      ', '8.1484375   ', '35.84375    '], time:0.195185ms
           out_f16x4pack(offset): ['-38.25      ', '8.1484375   ', '35.84375    '], time:0.194489ms
              out_f16x8pack(bcf): ['-38.25      ', '8.1484375   ', '35.84375    '], time:0.188848ms
           out_f16x8pack(offset): ['-38.25      ', '8.1484375   ', '35.84375    '], time:0.187315ms
                      out_f16_th: ['-38.5       ', '8.109375    ', '35.96875    '], time:0.089850ms
--------------------------------------------------------------------------------------------------------------
--------------------------------------------------------------------------------------------------------------
                                             M=2048, N=4096, K=1024
                         out_f16: ['-46.0625    ', '-31.671875  ', '7.41015625  '], time:4.740417ms
                     out_f16(sk): ['-46.0625    ', '-31.671875  ', '7.41015625  '], time:3.523793ms
          out_f16x4pack(t4x4bcf): ['-46.0625    ', '-31.671875  ', '7.41015625  '], time:0.525656ms
       out_f16x4pack(t4x4offset): ['-46.0625    ', '-31.671875  ', '7.41015625  '], time:0.514398ms
               out_f16x4(t8x8sk): ['-46.0625    ', '-31.671875  ', '7.41015625  '], time:0.444274ms
              out_f16x4(t8x8bcf): ['-46.0625    ', '-31.671875  ', '7.41015625  '], time:0.418189ms
           out_f16x4pack(t8x8sk): ['-46.0625    ', '-31.671875  ', '7.41015625  '], time:0.408354ms
              out_f16x4pack(bcf): ['-46.0625    ', '-31.671875  ', '7.41015625  '], time:0.384445ms
           out_f16x4pack(offset): ['-46.0625    ', '-31.671875  ', '7.41015625  '], time:0.383688ms
              out_f16x8pack(bcf): ['-46.0625    ', '-31.671875  ', '7.41015625  '], time:0.372740ms
           out_f16x8pack(offset): ['-46.0625    ', '-31.671875  ', '7.41015625  '], time:0.371087ms
                      out_f16_th: ['-46.0625    ', '-31.84375   ', '7.41015625  '], time:0.168835ms
--------------------------------------------------------------------------------------------------------------
--------------------------------------------------------------------------------------------------------------
                                             M=4096, N=1024, K=256
                         out_f16: ['11.09375    ', '-4.30078125 ', '28.75       '], time:0.606685ms
                     out_f16(sk): ['11.09375    ', '-4.30078125 ', '28.75       '], time:0.455339ms
          out_f16x4pack(t4x4bcf): ['11.09375    ', '-4.30078125 ', '28.75       '], time:0.070524ms
       out_f16x4pack(t4x4offset): ['11.09375    ', '-4.30078125 ', '28.75       '], time:0.069181ms
               out_f16x4(t8x8sk): ['11.09375    ', '-4.30078125 ', '28.75       '], time:0.065643ms
              out_f16x4(t8x8bcf): ['11.09375    ', '-4.30078125 ', '28.75       '], time:0.057961ms
           out_f16x4pack(t8x8sk): ['11.09375    ', '-4.30078125 ', '28.75       '], time:0.058129ms
              out_f16x4pack(bcf): ['11.09375    ', '-4.30078125 ', '28.75       '], time:0.053869ms
           out_f16x4pack(offset): ['11.09375    ', '-4.30078125 ', '28.75       '], time:0.053774ms
              out_f16x8pack(bcf): ['11.09375    ', '-4.30078125 ', '28.75       '], time:0.052531ms
           out_f16x8pack(offset): ['11.09375    ', '-4.30078125 ', '28.75       '], time:0.052143ms
                      out_f16_th: ['11.09375    ', '-4.328125   ', '28.78125    '], time:0.025280ms
--------------------------------------------------------------------------------------------------------------
--------------------------------------------------------------------------------------------------------------
                                             M=4096, N=1024, K=512
                         out_f16: ['6.16796875  ', '23.28125    ', '63.8125     '], time:1.199290ms
                     out_f16(sk): ['6.16796875  ', '23.28125    ', '63.8125     '], time:0.894740ms
          out_f16x4pack(t4x4bcf): ['6.16796875  ', '23.28125    ', '63.8125     '], time:0.139941ms
       out_f16x4pack(t4x4offset): ['6.16796875  ', '23.28125    ', '63.8125     '], time:0.137491ms
               out_f16x4(t8x8sk): ['6.16796875  ', '23.28125    ', '63.8125     '], time:0.120988ms
              out_f16x4(t8x8bcf): ['6.16796875  ', '23.28125    ', '63.8125     '], time:0.111963ms
           out_f16x4pack(t8x8sk): ['6.16796875  ', '23.28125    ', '63.8125     '], time:0.110834ms
              out_f16x4pack(bcf): ['6.16796875  ', '23.28125    ', '63.8125     '], time:0.103897ms
           out_f16x4pack(offset): ['6.16796875  ', '23.28125    ', '63.8125     '], time:0.103645ms
              out_f16x8pack(bcf): ['6.16796875  ', '23.28125    ', '63.8125     '], time:0.100538ms
           out_f16x8pack(offset): ['6.16796875  ', '23.28125    ', '63.8125     '], time:0.100353ms
                      out_f16_th: ['6.23046875  ', '23.265625   ', '63.40625    '], time:0.044990ms
--------------------------------------------------------------------------------------------------------------
--------------------------------------------------------------------------------------------------------------
                                             M=4096, N=1024, K=1024
                         out_f16: ['-65.5       ', '-9.8515625  ', '-25.921875  '], time:2.384896ms
                     out_f16(sk): ['-65.5       ', '-9.8515625  ', '-25.921875  '], time:1.774733ms
          out_f16x4pack(t4x4bcf): ['-65.5       ', '-9.8515625  ', '-25.921875  '], time:0.277911ms
       out_f16x4pack(t4x4offset): ['-65.5       ', '-9.8515625  ', '-25.921875  '], time:0.273759ms
               out_f16x4(t8x8sk): ['-65.5       ', '-9.8515625  ', '-25.921875  '], time:0.231657ms
              out_f16x4(t8x8bcf): ['-65.5       ', '-9.8515625  ', '-25.921875  '], time:0.219461ms
           out_f16x4pack(t8x8sk): ['-65.5       ', '-9.8515625  ', '-25.921875  '], time:0.215819ms
              out_f16x4pack(bcf): ['-65.5       ', '-9.8515625  ', '-25.921875  '], time:0.203251ms
           out_f16x4pack(offset): ['-65.5       ', '-9.8515625  ', '-25.921875  '], time:0.202671ms
              out_f16x8pack(bcf): ['-65.5       ', '-9.8515625  ', '-25.921875  '], time:0.196928ms
           out_f16x8pack(offset): ['-65.5       ', '-9.8515625  ', '-25.921875  '], time:0.195895ms
                      out_f16_th: ['-65.625     ', '-9.9375     ', '-26.03125   '], time:0.084260ms
--------------------------------------------------------------------------------------------------------------
--------------------------------------------------------------------------------------------------------------
                                             M=4096, N=2048, K=256
                         out_f16: ['-20.84375   ', '8.875       ', '-3.8828125  '], time:1.205260ms
                     out_f16(sk): ['-20.84375   ', '8.875       ', '-3.8828125  '], time:0.905329ms
          out_f16x4pack(t4x4bcf): ['-20.84375   ', '8.875       ', '-3.8828125  '], time:0.131099ms
       out_f16x4pack(t4x4offset): ['-20.84375   ', '8.875       ', '-3.8828125  '], time:0.128661ms
               out_f16x4(t8x8sk): ['-20.84375   ', '8.875       ', '-3.8828125  '], time:0.128078ms
              out_f16x4(t8x8bcf): ['-20.84375   ', '8.875       ', '-3.8828125  '], time:0.108449ms
           out_f16x4pack(t8x8sk): ['-20.84375   ', '8.875       ', '-3.8828125  '], time:0.109743ms
              out_f16x4pack(bcf): ['-20.84375   ', '8.875       ', '-3.8828125  '], time:0.099809ms
           out_f16x4pack(offset): ['-20.84375   ', '8.875       ', '-3.8828125  '], time:0.099596ms
              out_f16x8pack(bcf): ['-20.84375   ', '8.875       ', '-3.8828125  '], time:0.096962ms
           out_f16x8pack(offset): ['-20.84375   ', '8.875       ', '-3.8828125  '], time:0.095946ms
                      out_f16_th: ['-20.75      ', '8.875       ', '-3.875      '], time:0.046710ms
--------------------------------------------------------------------------------------------------------------
--------------------------------------------------------------------------------------------------------------
                                             M=4096, N=2048, K=512
                         out_f16: ['26.390625   ', '27.8125     ', '-30.59375   '], time:2.384545ms
                     out_f16(sk): ['26.390625   ', '27.8125     ', '-30.59375   '], time:1.779222ms
          out_f16x4pack(t4x4bcf): ['26.390625   ', '27.8125     ', '-30.59375   '], time:0.261164ms
       out_f16x4pack(t4x4offset): ['26.390625   ', '27.8125     ', '-30.59375   '], time:0.256294ms
               out_f16x4(t8x8sk): ['26.390625   ', '27.8125     ', '-30.59375   '], time:0.235556ms
              out_f16x4(t8x8bcf): ['26.390625   ', '27.8125     ', '-30.59375   '], time:0.211694ms
           out_f16x4pack(t8x8sk): ['26.390625   ', '27.8125     ', '-30.59375   '], time:0.209532ms
              out_f16x4pack(bcf): ['26.390625   ', '27.8125     ', '-30.59375   '], time:0.194987ms
           out_f16x4pack(offset): ['26.390625   ', '27.8125     ', '-30.59375   '], time:0.194519ms
              out_f16x8pack(bcf): ['26.390625   ', '27.8125     ', '-30.59375   '], time:0.188973ms
           out_f16x8pack(offset): ['26.390625   ', '27.8125     ', '-30.59375   '], time:0.187423ms
                      out_f16_th: ['26.40625    ', '27.640625   ', '-30.703125  '], time:0.086123ms
--------------------------------------------------------------------------------------------------------------
--------------------------------------------------------------------------------------------------------------
                                             M=4096, N=2048, K=1024
                         out_f16: ['38.0625     ', '11.765625   ', '9.7734375   '], time:4.739503ms
                     out_f16(sk): ['38.0625     ', '11.765625   ', '9.7734375   '], time:3.528736ms
          out_f16x4pack(t4x4bcf): ['38.0625     ', '11.765625   ', '9.7734375   '], time:0.524106ms
       out_f16x4pack(t4x4offset): ['38.0625     ', '11.765625   ', '9.7734375   '], time:0.517267ms
               out_f16x4(t8x8sk): ['38.0625     ', '11.765625   ', '9.7734375   '], time:0.448143ms
              out_f16x4(t8x8bcf): ['38.0625     ', '11.765625   ', '9.7734375   '], time:0.418208ms
           out_f16x4pack(t8x8sk): ['38.0625     ', '11.765625   ', '9.7734375   '], time:0.410209ms
              out_f16x4pack(bcf): ['38.0625     ', '11.765625   ', '9.7734375   '], time:0.384880ms
           out_f16x4pack(offset): ['38.0625     ', '11.765625   ', '9.7734375   '], time:0.384080ms
              out_f16x8pack(bcf): ['38.0625     ', '11.765625   ', '9.7734375   '], time:0.374737ms
           out_f16x8pack(offset): ['38.0625     ', '11.765625   ', '9.7734375   '], time:0.371141ms
                      out_f16_th: ['38.15625    ', '11.7890625  ', '9.71875     '], time:0.168827ms
--------------------------------------------------------------------------------------------------------------
--------------------------------------------------------------------------------------------------------------
                                             M=4096, N=4096, K=256
                         out_f16: ['35.53125    ', '31.109375   ', '-0.60400391 '], time:2.400335ms
                     out_f16(sk): ['35.53125    ', '31.109375   ', '-0.60400391 '], time:1.799110ms
          out_f16x4pack(t4x4bcf): ['35.53125    ', '31.109375   ', '-0.60400391 '], time:0.252537ms
       out_f16x4pack(t4x4offset): ['35.53125    ', '31.109375   ', '-0.60400391 '], time:0.247484ms
               out_f16x4(t8x8sk): ['35.53125    ', '31.109375   ', '-0.60400391 '], time:0.230805ms
              out_f16x4(t8x8bcf): ['35.53125    ', '31.109375   ', '-0.60400391 '], time:0.208215ms
           out_f16x4pack(t8x8sk): ['35.53125    ', '31.109375   ', '-0.60400391 '], time:0.206558ms
              out_f16x4pack(bcf): ['35.53125    ', '31.109375   ', '-0.60400391 '], time:0.191569ms
           out_f16x4pack(offset): ['35.53125    ', '31.109375   ', '-0.60400391 '], time:0.190972ms
              out_f16x8pack(bcf): ['35.53125    ', '31.109375   ', '-0.60400391 '], time:0.184975ms
           out_f16x8pack(offset): ['35.53125    ', '31.109375   ', '-0.60400391 '], time:0.183313ms
                      out_f16_th: ['35.5        ', '31.0625     ', '-0.60791016 '], time:0.088493ms
--------------------------------------------------------------------------------------------------------------
--------------------------------------------------------------------------------------------------------------
                                             M=4096, N=4096, K=512
                         out_f16: ['20.671875   ', '33.28125    ', '-0.69433594 '], time:4.749888ms
                     out_f16(sk): ['20.671875   ', '33.28125    ', '-0.69433594 '], time:3.542411ms
          out_f16x4pack(t4x4bcf): ['20.671875   ', '33.28125    ', '-0.69433594 '], time:0.513864ms
       out_f16x4pack(t4x4offset): ['20.671875   ', '33.28125    ', '-0.69433594 '], time:0.500157ms
               out_f16x4(t8x8sk): ['20.671875   ', '33.28125    ', '-0.69433594 '], time:0.441413ms
              out_f16x4(t8x8bcf): ['20.671875   ', '33.28125    ', '-0.69433594 '], time:0.410336ms
           out_f16x4pack(t8x8sk): ['20.671875   ', '33.28125    ', '-0.69433594 '], time:0.402255ms
              out_f16x4pack(bcf): ['20.671875   ', '33.28125    ', '-0.69433594 '], time:0.378996ms
           out_f16x4pack(offset): ['20.671875   ', '33.28125    ', '-0.69433594 '], time:0.376065ms
              out_f16x8pack(bcf): ['20.671875   ', '33.28125    ', '-0.69433594 '], time:0.366248ms
           out_f16x8pack(offset): ['20.671875   ', '33.28125    ', '-0.69433594 '], time:0.364445ms
                      out_f16_th: ['20.5625     ', '33.21875    ', '-0.73828125 '], time:0.168390ms
--------------------------------------------------------------------------------------------------------------
--------------------------------------------------------------------------------------------------------------
                                             M=4096, N=4096, K=1024
                         out_f16: ['22.234375   ', '40.28125    ', '-24.578125  '], time:9.448379ms
                     out_f16(sk): ['22.234375   ', '40.28125    ', '-24.578125  '], time:7.028021ms
          out_f16x4pack(t4x4bcf): ['22.234375   ', '40.28125    ', '-24.578125  '], time:1.032172ms
       out_f16x4pack(t4x4offset): ['22.234375   ', '40.28125    ', '-24.578125  '], time:1.023668ms
               out_f16x4(t8x8sk): ['22.234375   ', '40.28125    ', '-24.578125  '], time:0.857614ms
              out_f16x4(t8x8bcf): ['22.234375   ', '40.28125    ', '-24.578125  '], time:0.817854ms
           out_f16x4pack(t8x8sk): ['22.234375   ', '40.28125    ', '-24.578125  '], time:0.796847ms
              out_f16x4pack(bcf): ['22.234375   ', '40.28125    ', '-24.578125  '], time:0.753374ms
           out_f16x4pack(offset): ['22.234375   ', '40.28125    ', '-24.578125  '], time:0.750718ms
              out_f16x8pack(bcf): ['22.234375   ', '40.28125    ', '-24.578125  '], time:0.732352ms
           out_f16x8pack(offset): ['22.234375   ', '40.28125    ', '-24.578125  '], time:0.727910ms
                      out_f16_th: ['22.484375   ', '40.375      ', '-24.578125  '], time:0.333349ms
--------------------------------------------------------------------------------------------------------------
```
