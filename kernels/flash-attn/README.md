# FlashAttention

## 0x00 说明

包含以下内容：

- [X] flash_attn_cuda_kernel (F32)
- [x] flash_attn_mma_naive_kernel (ldmatrix + MMA)
- [X] flash_attn_mma_stage_kernel (ldmatrix + MMA, Multi-Stages, Tile MMA, Tile Warp, Copy Async, Collective Store)

本仓库FlashAttention仅用于学习CUDA编程，考虑性能最优请使用FlashAttention官方版本：[flash-attention](https://github.com/Dao-AILab/flash-attention)

### 运行测试   
```bash
# 只测试Ada架构 不指定默认编译所有架构 耗时较长: Volta, Ampere, Ada, Hopper, ...
export TORCH_CUDA_ARCH_LIST=Ada 
python3 flash_attn_mma.py
```
日志如下：
```bash
----------------------------------------------------------------------------------------------------
          B: batch_size, H: n_head, N: seq_len, D: head_dim, seed: 9808, Warmup: 2, Iters: 10
----------------------------------------------------------------------------------------------------
                         B=1, H=1, N=1024, D=64, Warmup: 2, Iters: 10
      naive(unfused): ['0.03108215  ', '0.04049683  ', '0.13012695  '], time:0.096726ms
          mma(naive): ['0.03103638  ', '0.04049683  ', '0.13024902  '], time:0.627756ms
         mma(stage1): ['0.03103638  ', '0.04049683  ', '0.13012695  '], time:0.076294ms
         mma(stage2): ['0.03103638  ', '0.04049683  ', '0.13012695  '], time:0.071239ms
             (flash): ['0.03106689  ', '0.04043579  ', '0.13012695  '], time:0.113630ms
----------------------------------------------------------------------------------------------------
                         B=1, H=1, N=1024, D=128, Warmup: 2, Iters: 10
      naive(unfused): ['-0.02702332 ', '0.0546875   ', '0.00376892  '], time:0.099111ms
          mma(naive): ['-0.02711487 ', '0.05456543  ', '0.00365067  '], time:1.225686ms
         mma(stage1): ['-0.02711487 ', '0.05459595  ', '0.00363922  '], time:0.110602ms
         mma(stage2): ['-0.02711487 ', '0.05459595  ', '0.00363922  '], time:0.103545ms
             (flash): ['-0.02708435 ', '0.05471802  ', '0.00377464  '], time:0.117970ms
----------------------------------------------------------------------------------------------------
                         B=1, H=1, N=2048, D=64, Warmup: 2, Iters: 10
      naive(unfused): ['-0.03356934 ', '-0.08734131 ', '0.00368309  '], time:0.147152ms
          mma(naive): ['-0.03356934 ', '-0.08728027 ', '0.00368881  '], time:2.426434ms
         mma(stage1): ['-0.03356934 ', '-0.08721924 ', '0.00372505  '], time:0.139952ms
         mma(stage2): ['-0.03356934 ', '-0.08721924 ', '0.00372505  '], time:0.128961ms
             (flash): ['-0.03359985 ', '-0.08734131 ', '0.00369263  '], time:0.124359ms
----------------------------------------------------------------------------------------------------
                         B=1, H=1, N=2048, D=128, Warmup: 2, Iters: 10
      naive(unfused): ['-0.01191711 ', '0.00137901  ', '-0.03765869 '], time:0.155616ms
          mma(naive): ['-0.0118866  ', '0.0013876   ', '-0.03768921 '], time:4.795837ms
         mma(stage1): ['-0.01185608 ', '0.0013485   ', '-0.03765869 '], time:0.206590ms
         mma(stage2): ['-0.01185608 ', '0.0013485   ', '-0.03765869 '], time:0.191665ms
             (flash): ['-0.01193237 ', '0.00137043  ', '-0.03768921 '], time:0.151610ms
----------------------------------------------------------------------------------------------------
                         B=1, H=4, N=1024, D=64, Warmup: 2, Iters: 10
      naive(unfused): ['0.0271759   ', '0.05413818  ', '-0.00186729 '], time:0.113392ms
          mma(naive): ['0.02714539  ', '0.05426025  ', '-0.00187588 '], time:0.641131ms
         mma(stage1): ['0.02711487  ', '0.05422974  ', '-0.00187778 '], time:0.078964ms
         mma(stage2): ['0.02711487  ', '0.05422974  ', '-0.00187778 '], time:0.072265ms
             (flash): ['0.02714539  ', '0.0541687   ', '-0.00189972 '], time:0.158095ms
----------------------------------------------------------------------------------------------------
                         B=1, H=4, N=1024, D=128, Warmup: 2, Iters: 10
      naive(unfused): ['0.0158844   ', '-0.00754929 ', '0.00613785  '], time:0.127459ms
          mma(naive): ['0.01583862  ', '-0.00758362 ', '0.00626755  '], time:1.240301ms
         mma(stage1): ['0.01583862  ', '-0.00751877 ', '0.00624847  '], time:0.113606ms
         mma(stage2): ['0.01583862  ', '-0.00751877 ', '0.00624847  '], time:0.105023ms
             (flash): ['0.01582336  ', '-0.00757217 ', '0.00618362  '], time:0.171828ms
----------------------------------------------------------------------------------------------------
                         B=1, H=4, N=2048, D=64, Warmup: 2, Iters: 10
      naive(unfused): ['-0.03106689 ', '-0.05130005 ', '0.0803833   '], time:0.324845ms
          mma(naive): ['-0.03108215 ', '-0.05130005 ', '0.0803833   '], time:2.490067ms
         mma(stage1): ['-0.03109741 ', '-0.05133057 ', '0.08050537  '], time:0.233722ms
         mma(stage2): ['-0.03109741 ', '-0.05133057 ', '0.08050537  '], time:0.226808ms
             (flash): ['-0.03106689 ', '-0.05130005 ', '0.0803833   '], time:0.164151ms
----------------------------------------------------------------------------------------------------
                         B=1, H=4, N=2048, D=128, Warmup: 2, Iters: 10
      naive(unfused): ['0.02972412  ', '0.00046968  ', '-0.01461792 '], time:0.343084ms
          mma(naive): ['0.02981567  ', '0.00053453  ', '-0.01461029 '], time:4.869938ms
         mma(stage1): ['0.02983093  ', '0.00058365  ', '-0.01464844 '], time:0.402784ms
         mma(stage2): ['0.02983093  ', '0.00058365  ', '-0.01464844 '], time:0.376034ms
             (flash): ['0.02975464  ', '0.00052071  ', '-0.01454926 '], time:0.218034ms
----------------------------------------------------------------------------------------------------
                         B=1, H=8, N=1024, D=64, Warmup: 2, Iters: 10
      naive(unfused): ['0.06121826  ', '0.04974365  ', '-0.02716064 '], time:0.140381ms
          mma(naive): ['0.06124878  ', '0.04974365  ', '-0.02714539 '], time:0.642967ms
         mma(stage1): ['0.06124878  ', '0.04968262  ', '-0.02716064 '], time:0.124836ms
         mma(stage2): ['0.06124878  ', '0.04968262  ', '-0.02716064 '], time:0.121498ms
             (flash): ['0.06121826  ', '0.04974365  ', '-0.0271759  '], time:0.139332ms
----------------------------------------------------------------------------------------------------
                         B=1, H=8, N=1024, D=128, Warmup: 2, Iters: 10
      naive(unfused): ['-0.00563049 ', '-0.03216553 ', '-0.06713867 '], time:0.162268ms
          mma(naive): ['-0.00570297 ', '-0.03219604 ', '-0.06689453 '], time:1.244783ms
         mma(stage1): ['-0.00573349 ', '-0.03216553 ', '-0.06695557 '], time:0.212502ms
         mma(stage2): ['-0.00573349 ', '-0.03216553 ', '-0.06695557 '], time:0.196338ms
             (flash): ['-0.00562668 ', '-0.03216553 ', '-0.06707764 '], time:0.170183ms
----------------------------------------------------------------------------------------------------
                         B=1, H=8, N=2048, D=64, Warmup: 2, Iters: 10
      naive(unfused): ['0.02246094  ', '0.05551147  ', '-0.04388428 '], time:0.682592ms
          mma(naive): ['0.0224762   ', '0.05551147  ', '-0.04391479 '], time:2.496171ms
         mma(stage1): ['0.02250671  ', '0.05551147  ', '-0.04394531 '], time:0.352001ms
         mma(stage2): ['0.02250671  ', '0.05551147  ', '-0.04394531 '], time:0.335956ms
             (flash): ['0.02249146  ', '0.05551147  ', '-0.04391479 '], time:0.208259ms
----------------------------------------------------------------------------------------------------
                         B=1, H=8, N=2048, D=128, Warmup: 2, Iters: 10
      naive(unfused): ['0.00337982  ', '0.03231812  ', '-0.03842163 '], time:0.758076ms
          mma(naive): ['0.00345421  ', '0.03237915  ', '-0.03848267 '], time:4.863000ms
         mma(stage1): ['0.00345993  ', '0.0322876   ', '-0.03851318 '], time:0.598788ms
         mma(stage2): ['0.00345993  ', '0.0322876   ', '-0.03851318 '], time:0.560379ms
             (flash): ['0.00337791  ', '0.03231812  ', '-0.03842163 '], time:0.317883ms
----------------------------------------------------------------------------------------------------
                         B=2, H=1, N=1024, D=64, Warmup: 2, Iters: 10
      naive(unfused): ['0.01637268  ', '0.03924561  ', '0.01605225  '], time:0.104356ms
          mma(naive): ['0.01638794  ', '0.03915405  ', '0.01600647  '], time:0.632811ms
         mma(stage1): ['0.01634216  ', '0.03918457  ', '0.01603699  '], time:0.077152ms
         mma(stage2): ['0.01634216  ', '0.03918457  ', '0.01603699  '], time:0.071812ms
             (flash): ['0.01635742  ', '0.03924561  ', '0.01603699  '], time:0.114679ms
----------------------------------------------------------------------------------------------------
                         B=2, H=1, N=1024, D=128, Warmup: 2, Iters: 10
      naive(unfused): ['-0.02867126 ', '-0.00822449 ', '0.04498291  '], time:0.108027ms
          mma(naive): ['-0.02857971 ', '-0.00826263 ', '0.04504395  '], time:1.232719ms
         mma(stage1): ['-0.02861023 ', '-0.00827789 ', '0.04501343  '], time:0.111103ms
         mma(stage2): ['-0.02861023 ', '-0.00827789 ', '0.04501343  '], time:0.104022ms
             (flash): ['-0.02870178 ', '-0.00823975 ', '0.04498291  '], time:0.124621ms
----------------------------------------------------------------------------------------------------
                         B=2, H=1, N=2048, D=64, Warmup: 2, Iters: 10
      naive(unfused): ['0.08618164  ', '0.10858154  ', '-0.04327393 '], time:0.206494ms
          mma(naive): ['0.08612061  ', '0.10858154  ', '-0.04318237 '], time:2.460766ms
         mma(stage1): ['0.08618164  ', '0.10858154  ', '-0.04324341 '], time:0.141644ms
         mma(stage2): ['0.08618164  ', '0.10858154  ', '-0.04324341 '], time:0.129485ms
             (flash): ['0.08618164  ', '0.10864258  ', '-0.04324341 '], time:0.138521ms
----------------------------------------------------------------------------------------------------
                         B=2, H=1, N=2048, D=128, Warmup: 2, Iters: 10
      naive(unfused): ['-0.0259552  ', '-0.00799561 ', '0.04824829  '], time:0.215316ms
          mma(naive): ['-0.02587891 ', '-0.00795746 ', '0.04824829  '], time:4.819489ms
         mma(stage1): ['-0.02590942 ', '-0.00798035 ', '0.04821777  '], time:0.208998ms
         mma(stage2): ['-0.02590942 ', '-0.00798035 ', '0.04821777  '], time:0.196552ms
             (flash): ['-0.0259552  ', '-0.00798798 ', '0.04821777  '], time:0.167274ms
----------------------------------------------------------------------------------------------------
                         B=2, H=4, N=1024, D=64, Warmup: 2, Iters: 10
      naive(unfused): ['-0.02813721 ', '0.01526642  ', '-0.02537537 '], time:0.138974ms
          mma(naive): ['-0.02799988 ', '0.01526642  ', '-0.02539062 '], time:0.640178ms
         mma(stage1): ['-0.0280304  ', '0.01525116  ', '-0.02539062 '], time:0.124788ms
         mma(stage2): ['-0.0280304  ', '0.01525116  ', '-0.02539062 '], time:0.121617ms
             (flash): ['-0.02809143 ', '0.0152359   ', '-0.02539062 '], time:0.139785ms
----------------------------------------------------------------------------------------------------
                         B=2, H=4, N=1024, D=128, Warmup: 2, Iters: 10
      naive(unfused): ['-0.05459595 ', '-0.04788208 ', '0.09368896  '], time:0.163364ms
          mma(naive): ['-0.05459595 ', '-0.04776001 ', '0.09381104  '], time:1.242661ms
         mma(stage1): ['-0.05456543 ', '-0.04776001 ', '0.09381104  '], time:0.213170ms
         mma(stage2): ['-0.05456543 ', '-0.04776001 ', '0.09381104  '], time:0.196600ms
             (flash): ['-0.05462646 ', '-0.04785156 ', '0.09368896  '], time:0.168061ms
----------------------------------------------------------------------------------------------------
                         B=2, H=4, N=2048, D=64, Warmup: 2, Iters: 10
      naive(unfused): ['-0.00146866 ', '0.01861572  ', '-0.06634521 '], time:0.683403ms
          mma(naive): ['-0.00153255 ', '0.01861572  ', '-0.06640625 '], time:2.493167ms
         mma(stage1): ['-0.00151825 ', '0.0186615   ', '-0.06640625 '], time:0.352097ms
         mma(stage2): ['-0.00151825 ', '0.0186615   ', '-0.06640625 '], time:0.336695ms
             (flash): ['-0.00150967 ', '0.01864624  ', '-0.06634521 '], time:0.204277ms
----------------------------------------------------------------------------------------------------
                         B=2, H=4, N=2048, D=128, Warmup: 2, Iters: 10
      naive(unfused): ['0.02212524  ', '0.01538849  ', '-0.05194092 '], time:0.758600ms
          mma(naive): ['0.0221405   ', '0.01541901  ', '-0.05200195 '], time:4.865360ms
         mma(stage1): ['0.0221405   ', '0.01544952  ', '-0.05200195 '], time:0.599480ms
         mma(stage2): ['0.0221405   ', '0.01544952  ', '-0.05200195 '], time:0.560617ms
             (flash): ['0.0221405   ', '0.01538086  ', '-0.05197144 '], time:0.317097ms
----------------------------------------------------------------------------------------------------
                         B=2, H=8, N=1024, D=64, Warmup: 2, Iters: 10
      naive(unfused): ['-0.00810242 ', '0.09655762  ', '-0.08215332 '], time:0.257015ms
          mma(naive): ['-0.00809479 ', '0.09661865  ', '-0.08203125 '], time:0.642824ms
         mma(stage1): ['-0.00809479 ', '0.09661865  ', '-0.08197021 '], time:0.184608ms
         mma(stage2): ['-0.00809479 ', '0.09661865  ', '-0.08197021 '], time:0.177050ms
             (flash): ['-0.00811005 ', '0.09661865  ', '-0.08203125 '], time:0.146127ms
----------------------------------------------------------------------------------------------------
                         B=2, H=8, N=1024, D=128, Warmup: 2, Iters: 10
      naive(unfused): ['0.03250122  ', '-0.04782104 ', '-0.00722885 '], time:0.301957ms
          mma(naive): ['0.03225708  ', '-0.04779053 ', '-0.00724411 '], time:1.245642ms
         mma(stage1): ['0.03231812  ', '-0.04776001 ', '-0.00725937 '], time:0.313854ms
         mma(stage2): ['0.03231812  ', '-0.04776001 ', '-0.00725937 '], time:0.288534ms
             (flash): ['0.03250122  ', '-0.04782104 ', '-0.00721741 '], time:0.203753ms
----------------------------------------------------------------------------------------------------
                         B=2, H=8, N=2048, D=64, Warmup: 2, Iters: 10
      naive(unfused): ['0.07409668  ', '-0.01872253 ', '0.04016113  '], time:1.560426ms
          mma(naive): ['0.07409668  ', '-0.01876831 ', '0.04016113  '], time:2.491570ms
         mma(stage1): ['0.07403564  ', '-0.01870728 ', '0.04016113  '], time:0.662446ms
         mma(stage2): ['0.07403564  ', '-0.01870728 ', '0.04016113  '], time:0.645900ms
             (flash): ['0.07409668  ', '-0.01873779 ', '0.04016113  '], time:0.264311ms
----------------------------------------------------------------------------------------------------
                         B=2, H=8, N=2048, D=128, Warmup: 2, Iters: 10
      naive(unfused): ['0.03771973  ', '-0.04916382 ', '0.01473236  '], time:1.625800ms
          mma(naive): ['0.03768921  ', '-0.04922485 ', '0.01473999  '], time:4.866195ms
         mma(stage1): ['0.03768921  ', '-0.04919434 ', '0.0147171   '], time:1.174974ms
         mma(stage2): ['0.03768921  ', '-0.04919434 ', '0.0147171   '], time:1.094818ms
             (flash): ['0.03768921  ', '-0.04919434 ', '0.01473236  '], time:0.430560ms
----------------------------------------------------------------------------------------------------
                         B=4, H=1, N=1024, D=64, Warmup: 2, Iters: 10
      naive(unfused): ['0.11962891  ', '-0.05975342 ', '0.00798798  '], time:0.115967ms
          mma(naive): ['0.11962891  ', '-0.05978394 ', '0.00788116  '], time:0.637579ms
         mma(stage1): ['0.11962891  ', '-0.05978394 ', '0.00785828  '], time:0.078273ms
         mma(stage2): ['0.11962891  ', '-0.05978394 ', '0.00785828  '], time:0.072408ms
             (flash): ['0.11962891  ', '-0.05978394 ', '0.00801849  '], time:0.121927ms
----------------------------------------------------------------------------------------------------
                         B=4, H=1, N=1024, D=128, Warmup: 2, Iters: 10
      naive(unfused): ['0.04211426  ', '0.00664902  ', '-0.10076904 '], time:0.126052ms
          mma(naive): ['0.04214478  ', '0.00667572  ', '-0.10076904 '], time:1.242161ms
         mma(stage1): ['0.04214478  ', '0.00667191  ', '-0.10076904 '], time:0.113130ms
         mma(stage2): ['0.04214478  ', '0.00667191  ', '-0.10076904 '], time:0.105238ms
             (flash): ['0.04211426  ', '0.00666428  ', '-0.10076904 '], time:0.143170ms
----------------------------------------------------------------------------------------------------
                         B=4, H=1, N=2048, D=64, Warmup: 2, Iters: 10
      naive(unfused): ['-0.0120697  ', '0.04391479  ', '0.00071001  '], time:0.322890ms
          mma(naive): ['-0.01210785 ', '0.04388428  ', '0.00067329  '], time:2.493715ms
         mma(stage1): ['-0.01210785 ', '0.04388428  ', '0.00064659  '], time:0.233269ms
         mma(stage2): ['-0.01210785 ', '0.04388428  ', '0.00064659  '], time:0.226903ms
             (flash): ['-0.01205444 ', '0.04391479  ', '0.00071907  '], time:0.161576ms
----------------------------------------------------------------------------------------------------
                         B=4, H=1, N=2048, D=128, Warmup: 2, Iters: 10
      naive(unfused): ['-0.00566864 ', '-0.05874634 ', '0.02372742  '], time:0.343108ms
          mma(naive): ['-0.00563812 ', '-0.0586853  ', '0.02368164  '], time:4.869103ms
         mma(stage1): ['-0.00562668 ', '-0.05871582 ', '0.02372742  '], time:0.403976ms
         mma(stage2): ['-0.00562668 ', '-0.05871582 ', '0.02372742  '], time:0.540304ms
             (flash): ['-0.00568008 ', '-0.05874634 ', '0.02372742  '], time:0.221229ms
----------------------------------------------------------------------------------------------------
                         B=4, H=4, N=1024, D=64, Warmup: 2, Iters: 10
      naive(unfused): ['-0.05386353 ', '0.06048584  ', '-0.07568359 '], time:0.236988ms
          mma(naive): ['-0.05386353 ', '0.06045532  ', '-0.07568359 '], time:0.642180ms
         mma(stage1): ['-0.05383301 ', '0.06045532  ', '-0.07568359 '], time:0.184727ms
         mma(stage2): ['-0.05383301 ', '0.06045532  ', '-0.07568359 '], time:0.176978ms
             (flash): ['-0.05389404 ', '0.06045532  ', '-0.07568359 '], time:0.148678ms
----------------------------------------------------------------------------------------------------
                         B=4, H=4, N=1024, D=128, Warmup: 2, Iters: 10
      naive(unfused): ['-0.05410767 ', '-0.03649902 ', '0.00786591  '], time:0.308037ms
          mma(naive): ['-0.05422974 ', '-0.03659058 ', '0.00788879  '], time:1.246309ms
         mma(stage1): ['-0.05426025 ', '-0.03659058 ', '0.00793457  '], time:0.312686ms
         mma(stage2): ['-0.05426025 ', '-0.03659058 ', '0.00793457  '], time:0.288701ms
             (flash): ['-0.05413818 ', '-0.03656006 ', '0.00791168  '], time:0.203609ms
----------------------------------------------------------------------------------------------------
                         B=4, H=4, N=2048, D=64, Warmup: 2, Iters: 10
      naive(unfused): ['-0.00850677 ', '-0.04943848 ', '0.01248932  '], time:1.561117ms
          mma(naive): ['-0.00853729 ', '-0.04946899 ', '0.0124588   '], time:2.495432ms
         mma(stage1): ['-0.0085144  ', '-0.04943848 ', '0.01245117  '], time:0.662684ms
         mma(stage2): ['-0.0085144  ', '-0.04943848 ', '0.01245117  '], time:0.645208ms
             (flash): ['-0.00850677 ', '-0.04946899 ', '0.01248932  '], time:0.265336ms
----------------------------------------------------------------------------------------------------
                         B=4, H=4, N=2048, D=128, Warmup: 2, Iters: 10
      naive(unfused): ['0.02682495  ', '-0.01217651 ', '0.01435089  '], time:1.623440ms
          mma(naive): ['0.02676392  ', '-0.01224518 ', '0.01431274  '], time:4.856825ms
         mma(stage1): ['0.02676392  ', '-0.01220703 ', '0.014328    '], time:1.175261ms
         mma(stage2): ['0.02676392  ', '-0.01220703 ', '0.014328    '], time:1.096010ms
             (flash): ['0.02679443  ', '-0.0121994  ', '0.01433563  '], time:0.430107ms
----------------------------------------------------------------------------------------------------
                         B=4, H=8, N=1024, D=64, Warmup: 2, Iters: 10
      naive(unfused): ['0.05081177  ', '-0.01072693 ', '-0.02139282 '], time:0.614309ms
          mma(naive): ['0.0508728   ', '-0.0107193  ', '-0.0214386  '], time:0.644636ms
         mma(stage1): ['0.05084229  ', '-0.01068878 ', '-0.0214386  '], time:0.341058ms
         mma(stage2): ['0.05084229  ', '-0.01068878 ', '-0.0214386  '], time:0.332880ms
             (flash): ['0.05081177  ', '-0.01076508 ', '-0.02140808 '], time:0.176859ms
----------------------------------------------------------------------------------------------------
                         B=4, H=8, N=1024, D=128, Warmup: 2, Iters: 10
      naive(unfused): ['-0.03921509 ', '-0.08166504 ', '0.02574158  '], time:0.658703ms
          mma(naive): ['-0.03921509 ', '-0.08166504 ', '0.02572632  '], time:1.248908ms
         mma(stage1): ['-0.03918457 ', '-0.08172607 ', '0.02566528  '], time:0.602794ms
         mma(stage2): ['-0.03918457 ', '-0.08172607 ', '0.02566528  '], time:0.560331ms
             (flash): ['-0.03921509 ', '-0.081604   ', '0.02571106  '], time:0.261068ms
----------------------------------------------------------------------------------------------------
                         B=4, H=8, N=2048, D=64, Warmup: 2, Iters: 10
      naive(unfused): ['-0.01503754 ', '0.01425934  ', '0.0289917   '], time:3.032947ms
          mma(naive): ['-0.01506805 ', '0.0142746   ', '0.02905273  '], time:2.504969ms
         mma(stage1): ['-0.01507568 ', '0.01428986  ', '0.02906799  '], time:1.296997ms
         mma(stage2): ['-0.01507568 ', '0.01428986  ', '0.02906799  '], time:1.266813ms
             (flash): ['-0.01503754 ', '0.01428986  ', '0.02900696  '], time:0.429654ms
----------------------------------------------------------------------------------------------------
                         B=4, H=8, N=2048, D=128, Warmup: 2, Iters: 10
      naive(unfused): ['0.00343132  ', '0.04193115  ', '-0.01423645 '], time:3.122687ms
          mma(naive): ['0.00342178  ', '0.04196167  ', '-0.01425171 '], time:4.868150ms
         mma(stage1): ['0.00344467  ', '0.04196167  ', '-0.01423645 '], time:2.324080ms
         mma(stage2): ['0.00344467  ', '0.04196167  ', '-0.01423645 '], time:2.156138ms
             (flash): ['0.0034256   ', '0.04196167  ', '-0.01421356 '], time:0.761056ms
----------------------------------------------------------------------------------------------------
```
