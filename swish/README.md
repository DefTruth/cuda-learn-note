# Swish

## 0x00 说明

包含以下内容：

- [X] swish_f32_kernel
- [X] swish_f32x4_kernel(float4向量化版本)
- [X] swish_f16_kernel(fp16版本)
- [X] swish_f16x2_kernel(fp16向量化版本)
- [X] swish_f16x8_kernel(fp16向量化版本)
- [X] swish_f16x8_pack_kernel(fp16向量化，pack版本)
- [X] PyTorch bindings


## 测试

```bash
# 只测试Ada架构 不指定默认编译所有架构 耗时较长: Volta, Ampere, Ada, Hopper, ...
export TORCH_CUDA_ARCH_LIST=Ada 
python3 relu.py
```

输出:

```bash
-------------------------------------------------------------------------------------
                                        S=1024, K=1024
           out_f32: ['-0.27626503 ', '-0.04989763 '], time:0.00399876ms
         out_f32x4: ['-0.27626503 ', '-0.04989763 '], time:0.00343800ms
        out_f32_th: ['-0.27626505 ', '-0.04989763 '], time:0.00745869ms
-------------------------------------------------------------------------------------
           out_f16: ['-0.27636719 ', '-0.04989624 '], time:0.00438786ms
         out_f16x2: ['-0.27636719 ', '-0.04989624 '], time:0.00286722ms
         out_f16x8: ['-0.27636719 ', '-0.04989624 '], time:0.00279593ms
     out_f16x8pack: ['-0.27636719 ', '-0.04989624 '], time:0.00246906ms
        out_f16_th: ['-0.27636719 ', '-0.04989624 '], time:0.00530934ms
-------------------------------------------------------------------------------------
-------------------------------------------------------------------------------------
                                        S=1024, K=2048
           out_f32: ['-0.11616411 ', '0.92168581  '], time:0.00554204ms
         out_f32x4: ['-0.11616411 ', '0.92168581  '], time:0.00527859ms
        out_f32_th: ['-0.11616411 ', '0.92168581  '], time:0.01150441ms
-------------------------------------------------------------------------------------
           out_f16: ['-0.11608887 ', '0.92089844  '], time:0.00581026ms
         out_f16x2: ['-0.11608887 ', '0.92089844  '], time:0.00510240ms
         out_f16x8: ['-0.11608887 ', '0.92089844  '], time:0.00489950ms
     out_f16x8pack: ['-0.11608887 ', '0.92089844  '], time:0.00348830ms
        out_f16_th: ['-0.1161499  ', '0.921875    '], time:0.00732565ms
-------------------------------------------------------------------------------------
-------------------------------------------------------------------------------------
                                        S=1024, K=4096
           out_f32: ['1.75988805  ', '-0.07706322 '], time:0.00934935ms
         out_f32x4: ['1.75988805  ', '-0.07706322 '], time:0.00900555ms
        out_f32_th: ['1.75988805  ', '-0.07706322 '], time:0.01952362ms
-------------------------------------------------------------------------------------
           out_f16: ['1.75878906  ', '-0.07702637 '], time:0.00990725ms
         out_f16x2: ['1.75878906  ', '-0.07702637 '], time:0.00903893ms
         out_f16x8: ['1.75878906  ', '-0.07702637 '], time:0.00909162ms
     out_f16x8pack: ['1.75878906  ', '-0.07702637 '], time:0.00556612ms
        out_f16_th: ['1.75878906  ', '-0.07702637 '], time:0.01149321ms
-------------------------------------------------------------------------------------
-------------------------------------------------------------------------------------
                                        S=2048, K=1024
           out_f32: ['-0.2783826  ', '-0.11238551 '], time:0.00662041ms
         out_f32x4: ['-0.2783826  ', '-0.11238551 '], time:0.00530052ms
        out_f32_th: ['-0.2783826  ', '-0.11238552 '], time:0.01146960ms
-------------------------------------------------------------------------------------
           out_f16: ['-0.27856445 ', '-0.11242676 '], time:0.00733256ms
         out_f16x2: ['-0.27856445 ', '-0.11242676 '], time:0.00414872ms
         out_f16x8: ['-0.27856445 ', '-0.11242676 '], time:0.00447845ms
     out_f16x8pack: ['-0.27856445 ', '-0.11242676 '], time:0.00336623ms
        out_f16_th: ['-0.27832031 ', '-0.11236572 '], time:0.00891113ms
-------------------------------------------------------------------------------------
-------------------------------------------------------------------------------------
                                        S=2048, K=2048
           out_f32: ['-0.2677404  ', '0.06417678  '], time:0.01659989ms
         out_f32x4: ['-0.2677404  ', '0.06417678  '], time:0.02058291ms
        out_f32_th: ['-0.2677404  ', '0.06417678  '], time:0.02069759ms
-------------------------------------------------------------------------------------
           out_f16: ['-0.26757812 ', '0.06414795  '], time:0.00988817ms
         out_f16x2: ['-0.26757812 ', '0.06414795  '], time:0.00977159ms
         out_f16x8: ['-0.26757812 ', '0.06414795  '], time:0.00958800ms
     out_f16x8pack: ['-0.26757812 ', '0.06414795  '], time:0.00598550ms
        out_f16_th: ['-0.26782227 ', '0.06420898  '], time:0.01161885ms
-------------------------------------------------------------------------------------
-------------------------------------------------------------------------------------
                                        S=2048, K=4096
           out_f32: ['0.87521237  ', '-0.23885883 '], time:0.01902914ms
         out_f32x4: ['0.87521237  ', '-0.23885883 '], time:0.01689911ms
        out_f32_th: ['0.87521237  ', '-0.23885885 '], time:0.03624034ms
-------------------------------------------------------------------------------------
           out_f16: ['0.875       ', '-0.23876953 '], time:0.01800466ms
         out_f16x2: ['0.875       ', '-0.23876953 '], time:0.01659966ms
         out_f16x8: ['0.875       ', '-0.23876953 '], time:0.01692343ms
     out_f16x8pack: ['0.875       ', '-0.23876953 '], time:0.00913978ms
        out_f16_th: ['0.875       ', '-0.23876953 '], time:0.01969314ms
-------------------------------------------------------------------------------------
-------------------------------------------------------------------------------------
                                        S=4096, K=1024
           out_f32: ['1.20880175  ', '0.23003602  '], time:0.01281476ms
         out_f32x4: ['1.20880175  ', '0.23003602  '], time:0.00889063ms
        out_f32_th: ['1.20880175  ', '0.23003602  '], time:0.02118397ms
-------------------------------------------------------------------------------------
           out_f16: ['1.20996094  ', '0.22998047  '], time:0.01336646ms
         out_f16x2: ['1.20996094  ', '0.22998047  '], time:0.00935316ms
         out_f16x8: ['1.20996094  ', '0.22998047  '], time:0.00812125ms
     out_f16x8pack: ['1.20996094  ', '0.22998047  '], time:0.00540519ms
        out_f16_th: ['1.20898438  ', '0.22998047  '], time:0.01149321ms
-------------------------------------------------------------------------------------
-------------------------------------------------------------------------------------
                                        S=4096, K=2048
           out_f32: ['-0.20028742 ', '0.00593234  '], time:0.03857923ms
         out_f32x4: ['-0.20028742 ', '0.00593234  '], time:0.01753092ms
        out_f32_th: ['-0.20028742 ', '0.00593234  '], time:0.03842711ms
-------------------------------------------------------------------------------------
           out_f16: ['-0.20019531 ', '0.00593185  '], time:0.01945615ms
         out_f16x2: ['-0.20019531 ', '0.00593185  '], time:0.03284836ms
         out_f16x8: ['-0.20019531 ', '0.00593185  '], time:0.01644540ms
     out_f16x8pack: ['-0.20019531 ', '0.00593185  '], time:0.01503658ms
        out_f16_th: ['-0.20019531 ', '0.00593185  '], time:0.03441119ms
-------------------------------------------------------------------------------------
-------------------------------------------------------------------------------------
                                        S=4096, K=4096
           out_f32: ['0.68447012  ', '0.60815662  '], time:0.25561571ms
         out_f32x4: ['0.68447012  ', '0.60815662  '], time:0.27445269ms
        out_f32_th: ['0.68447006  ', '0.60815662  '], time:0.65941596ms
-------------------------------------------------------------------------------------
           out_f16: ['0.68457031  ', '0.60791016  '], time:0.06837082ms
         out_f16x2: ['0.68457031  ', '0.60791016  '], time:0.06547904ms
         out_f16x8: ['0.68457031  ', '0.60791016  '], time:0.04474044ms
     out_f16x8pack: ['0.68457031  ', '0.60791016  '], time:0.03068280ms
        out_f16_th: ['0.68457031  ', '0.60791016  '], time:0.03648376ms
-------------------------------------------------------------------------------------

```
