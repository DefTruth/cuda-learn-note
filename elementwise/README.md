# Elementwise

## 0x00 说明

包含以下内容：

- [X] elementwise_add_f32_kernel
- [X] elementwise_add_f32x4_kernel(float4向量化版本)
- [X] elementwise_add_f16_kernel(fp16版本)
- [X] elementwise_add_f16x2_kernel(fp16向量化版本)
- [X] elementwise_add_f16x8_kernel(fp16向量化版本)
- [X] elementwise_add_f16x8_pack_kernel(fp16向量化版本, pack)
- [X] PyTorch bindings


## 测试

```bash
# 只测试Ada架构 不指定默认编译所有架构 耗时较长: Volta, Ampere, Ada, Hopper, ...
export TORCH_CUDA_ARCH_LIST=Ada 
python3 elementwise.py
```

输出:

```bash
-------------------------------------------------------------------------------------
                                        S=1024, K=1024
           out_f32: [-1.93139732, 2.28840184], time:0.03384757ms
         out_f32x4: [-1.93139732, 2.28840184], time:0.03474021ms
        out_f32_th: [-1.93139732, 2.28840184], time:0.03424430ms
-------------------------------------------------------------------------------------
           out_f16: [-1.93164062, 2.2890625], time:0.03949046ms
         out_f16x2: [-1.93164062, 2.2890625], time:0.02557135ms
         out_f16x8: [-1.93164062, 2.2890625], time:0.01869559ms
     out_f16x8pack: [-1.93164062, 2.2890625], time:0.02327323ms
        out_f16_th: [-1.93164062, 2.2890625], time:0.01738501ms
-------------------------------------------------------------------------------------
-------------------------------------------------------------------------------------
                                        S=1024, K=2048
           out_f32: [0.50591815, 1.85913599], time:0.06778336ms
         out_f32x4: [0.50591815, 1.85913599], time:0.06514335ms
        out_f32_th: [0.50591815, 1.85913599], time:0.06610560ms
-------------------------------------------------------------------------------------
           out_f16: [0.50585938, 1.859375], time:0.03394747ms
         out_f16x2: [0.50585938, 1.859375], time:0.03529453ms
         out_f16x8: [0.50585938, 1.859375], time:0.03390980ms
     out_f16x8pack: [0.50585938, 1.859375], time:0.03404665ms
        out_f16_th: [0.50585938, 1.859375], time:0.03606343ms
-------------------------------------------------------------------------------------
-------------------------------------------------------------------------------------
                                        S=1024, K=4096
           out_f32: [1.35648966, 0.02919749], time:0.12646604ms
         out_f32x4: [1.35648966, 0.02919749], time:0.12698913ms
        out_f32_th: [1.35648966, 0.02919749], time:0.12678957ms
-------------------------------------------------------------------------------------
           out_f16: [1.35644531, 0.0291748], time:0.06360340ms
         out_f16x2: [1.35644531, 0.0291748], time:0.06680608ms
         out_f16x8: [1.35644531, 0.0291748], time:0.06713676ms
     out_f16x8pack: [1.35644531, 0.0291748], time:0.06443000ms
        out_f16_th: [1.35644531, 0.0291748], time:0.06681275ms
-------------------------------------------------------------------------------------
-------------------------------------------------------------------------------------
                                        S=2048, K=1024
           out_f32: [0.63810885, 0.42702067], time:0.06265807ms
         out_f32x4: [0.63810885, 0.42702067], time:0.06672764ms
        out_f32_th: [0.63810885, 0.42702067], time:0.06397057ms
-------------------------------------------------------------------------------------
           out_f16: [0.63769531, 0.42700195], time:0.03774953ms
         out_f16x2: [0.63769531, 0.42700195], time:0.03663683ms
         out_f16x8: [0.63769531, 0.42700195], time:0.03439927ms
     out_f16x8pack: [0.63769531, 0.42700195], time:0.03473949ms
        out_f16_th: [0.63769531, 0.42700195], time:0.03434682ms
-------------------------------------------------------------------------------------
-------------------------------------------------------------------------------------
                                        S=2048, K=2048
           out_f32: [-1.00721264, 1.42797279], time:0.12655950ms
         out_f32x4: [-1.00721264, 1.42797279], time:0.12685752ms
        out_f32_th: [-1.00721264, 1.42797279], time:0.12450576ms
-------------------------------------------------------------------------------------
           out_f16: [-1.00683594, 1.42871094], time:0.06352139ms
         out_f16x2: [-1.00683594, 1.42871094], time:0.06325340ms
         out_f16x8: [-1.00683594, 1.42871094], time:0.06805634ms
     out_f16x8pack: [-1.00683594, 1.42871094], time:0.06836891ms
        out_f16_th: [-1.00683594, 1.42871094], time:0.07040763ms
-------------------------------------------------------------------------------------
-------------------------------------------------------------------------------------
                                        S=2048, K=4096
           out_f32: [1.38926435, -1.47093105], time:0.25655317ms
         out_f32x4: [1.38926435, -1.47093105], time:0.25660658ms
        out_f32_th: [1.38926435, -1.47093105], time:0.25458860ms
-------------------------------------------------------------------------------------
           out_f16: [1.38867188, -1.47070312], time:0.12320447ms
         out_f16x2: [1.38867188, -1.47070312], time:0.12841296ms
         out_f16x8: [1.38867188, -1.47070312], time:0.12936163ms
     out_f16x8pack: [1.38867188, -1.47070312], time:0.12497449ms
        out_f16_th: [1.38867188, -1.47070312], time:0.12746716ms
-------------------------------------------------------------------------------------
-------------------------------------------------------------------------------------
                                        S=4096, K=1024
           out_f32: [0.74535954, -1.55691564], time:0.12308216ms
         out_f32x4: [0.74535954, -1.55691564], time:0.12526536ms
        out_f32_th: [0.74535954, -1.55691564], time:0.12528610ms
-------------------------------------------------------------------------------------
           out_f16: [0.74560547, -1.55664062], time:0.07049274ms
         out_f16x2: [0.74560547, -1.55664062], time:0.06624007ms
         out_f16x8: [0.74560547, -1.55664062], time:0.06461859ms
     out_f16x8pack: [0.74560547, -1.55664062], time:0.06446695ms
        out_f16_th: [0.74560547, -1.55664062], time:0.06668615ms
-------------------------------------------------------------------------------------
-------------------------------------------------------------------------------------
                                        S=4096, K=2048
           out_f32: [-0.21382272, 1.11541057], time:0.24653506ms
         out_f32x4: [-0.21382272, 1.11541057], time:0.24692321ms
        out_f32_th: [-0.21382272, 1.11541057], time:0.24749994ms
-------------------------------------------------------------------------------------
           out_f16: [-0.21386719, 1.11523438], time:0.12876439ms
         out_f16x2: [-0.21386719, 1.11523438], time:0.12573600ms
         out_f16x8: [-0.21386719, 1.11523438], time:0.12889624ms
     out_f16x8pack: [-0.21386719, 1.11523438], time:0.12760592ms
        out_f16_th: [-0.21386719, 1.11523438], time:0.13299417ms
-------------------------------------------------------------------------------------
-------------------------------------------------------------------------------------
                                        S=4096, K=4096
           out_f32: [-3.13035107, 2.55200911], time:0.50568485ms
         out_f32x4: [-3.13035107, 2.55200911], time:0.49647403ms
        out_f32_th: [-3.13035107, 2.55200911], time:0.48980927ms
-------------------------------------------------------------------------------------
           out_f16: [-3.13085938, 2.55078125], time:0.24537802ms
         out_f16x2: [-3.13085938, 2.55078125], time:0.24679828ms
         out_f16x8: [-3.13085938, 2.55078125], time:0.24622416ms
     out_f16x8pack: [-3.13085938, 2.55078125], time:0.24645567ms
        out_f16_th: [-3.13085938, 2.55078125], time:0.24989390ms
-------------------------------------------------------------------------------------
```
