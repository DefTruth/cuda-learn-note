# Softmax

## 0x00 说明

包含以下内容：

- [X] softmax_f32_kernel (grid level memory fence)
- [X] softmax_f32x4_kernel(grid level memory fence, float4向量化版本)
- [X] softmax_f32_per_token_kernel(per token)
- [X] softmax_f32x4_per_token_kernel(per token, float4向量化版本)
- [X] safe_softmax_f32_per_token_kernel(per token)
- [X] safe_softmax_f32x4_per_token_kernel(per token, float4向量化版本)
- [X] PyTorch bindings


## 测试

```bash
# 只测试Ada架构 不指定默认编译所有架构 耗时较长
export TORCH_CUDA_ARCH_LIST=Ada 
python3 softmax.py
```

输出:

```bash
--------------------------------------------------------------------------------
             out_f32: [1.909e-05, 0.00023536, 0.00010881], time:0.01697016ms
           out_f32x4: [1.909e-05, 0.00023536, 0.00010881], time:0.01716042ms
          out_f32_th: [1.909e-05, 0.00023536, 0.00010881], time:0.00715089ms
--------------------------------------------------------------------------------
         out_f32(v2): [1.909e-05, 0.00023536, 0.00010881], time:0.01011539ms
       out_f32x4(v2): [1.909e-05, 0.00023536, 0.00010881], time:0.01006842ms
      out_f32_th(v2): [1.909e-05, 0.00023536, 0.00010881], time:0.00547409ms
--------------------------------------------------------------------------------
        out_f32(per): [0.00569158, 0.00022239, 0.00137839], time:0.01047754ms
      out_f32x4(per): [0.00569158, 0.00022239, 0.00137839], time:0.01045704ms
       out_f32(safe): [0.00569158, 0.00022239, 0.00137839], time:0.01054454ms
     out_f32x4(safe): [0.00569158, 0.00022239, 0.00137839], time:0.01042986ms
     out_f32_th(per): [0.00569158, 0.00022239, 0.00137839], time:0.00741696ms
--------------------------------------------------------------------------------
     out_f32(per v2): [0.00569158, 0.00022239, 0.00137839], time:0.00419974ms
   out_f32x4(per v2): [0.00569158, 0.00022239, 0.00137839], time:0.00316834ms
    out_f32(safe v2): [0.00569158, 0.00022239, 0.00137839], time:0.00603890ms
  out_f32x4(safe v2): [0.00569158, 0.00022239, 0.00137839], time:0.00319862ms
  out_f32_th(per v2): [0.00569158, 0.00022239, 0.00137839], time:0.00577068ms
--------------------------------------------------------------------------------
```