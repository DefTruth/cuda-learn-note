# Dot Product

## 0x00 说明

包含以下内容：

- [X] dot_prod_f32_f32_kernel
- [X] dot_prod_f32x4_f32_kernel(float4向量化版本)
- [X] dot_prod_f16_f32_kernel(fp16版本，使用fp32 acc)
- [X] dot_prod_f16x2_f32_kernel(fp16向量化版本，使用fp32 acc)
- [X] dot_prod_f16x8_pack_f32_kernel(fp16向量化版本，使用fp32 acc, pack)
- [X] PyTorch bindings

## 测试

```bash
# 只测试Ada架构 不指定默认编译所有架构 耗时较长: Volta, Ampere, Ada, Hopper, ...
export TORCH_CUDA_ARCH_LIST=Ada 
python3 dot_product.py
```

输出:

```bash
--------------------------------------------------------------------------------
                         S=1024, K=1024
       out_f32f32: -670.21264648  , time:0.08947158ms
     out_f32x4f32: -670.21435547  , time:0.02821302ms
    out_f32f32_th: -670.21374512  , time:0.09709382ms
--------------------------------------------------------------------------------
       out_f16f32: -670.32208252  , time:0.04000235ms
     out_f16x2f32: -670.15814209  , time:0.05491829ms
 out_f16x8packf32: -669.90997314  , time:0.01669478ms
    out_f16f16_th: -670.50000000  , time:0.02021313ms
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
                         S=1024, K=2048
       out_f32f32: 1040.51086426  , time:0.04557490ms
     out_f32x4f32: 1040.50720215  , time:0.06275582ms
    out_f32f32_th: 1040.50842285  , time:0.04762864ms
--------------------------------------------------------------------------------
       out_f16f32: 1041.44299316  , time:0.03214121ms
     out_f16x2f32: 1041.79589844  , time:0.03448486ms
 out_f16x8packf32: 1042.22717285  , time:0.02689457ms
    out_f16f16_th: 1041.00000000  , time:0.02859521ms
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
                         S=1024, K=4096
       out_f32f32: -1859.81457520 , time:0.08664179ms
     out_f32x4f32: -1859.81628418 , time:0.08621526ms
    out_f32f32_th: -1859.81933594 , time:0.08647323ms
--------------------------------------------------------------------------------
       out_f16f32: -1860.23291016 , time:0.05826116ms
     out_f16x2f32: -1860.91186523 , time:0.04677963ms
 out_f16x8packf32: -1860.25988770 , time:0.04591107ms
    out_f16f16_th: -1861.00000000 , time:0.04904127ms
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
                         S=2048, K=1024
       out_f32f32: 858.98229980   , time:0.04499865ms
     out_f32x4f32: 858.98461914   , time:0.04623890ms
    out_f32f32_th: 858.98376465   , time:0.06848693ms
--------------------------------------------------------------------------------
       out_f16f32: 858.85339355   , time:0.03274632ms
     out_f16x2f32: 858.94274902   , time:0.02831578ms
 out_f16x8packf32: 859.46844482   , time:0.02884459ms
    out_f16f16_th: 859.00000000   , time:0.03692698ms
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
                         S=2048, K=2048
       out_f32f32: -1205.77990723 , time:0.08356524ms
     out_f32x4f32: -1205.77624512 , time:0.08583307ms
    out_f32f32_th: -1205.77807617 , time:0.08613133ms
--------------------------------------------------------------------------------
       out_f16f32: -1205.40588379 , time:0.06001544ms
     out_f16x2f32: -1205.29028320 , time:0.04738235ms
 out_f16x8packf32: -1205.72924805 , time:0.04624581ms
    out_f16f16_th: -1205.00000000 , time:0.04907203ms
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
                         S=2048, K=4096
       out_f32f32: -893.49169922  , time:0.16136765ms
     out_f32x4f32: -893.48596191  , time:0.16174912ms
    out_f32f32_th: -893.48901367  , time:0.16518927ms
--------------------------------------------------------------------------------
       out_f16f32: -894.42169189  , time:0.11468077ms
     out_f16x2f32: -894.61779785  , time:0.08950567ms
 out_f16x8packf32: -895.26538086  , time:0.08448958ms
    out_f16f16_th: -894.00000000  , time:0.09156108ms
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
                         S=4096, K=1024
       out_f32f32: 141.78890991   , time:0.08385873ms
     out_f32x4f32: 141.78639221   , time:0.08500123ms
    out_f32f32_th: 141.78683472   , time:0.08647728ms
--------------------------------------------------------------------------------
       out_f16f32: 141.80113220   , time:0.05876780ms
     out_f16x2f32: 141.62113953   , time:0.04708385ms
 out_f16x8packf32: 141.15240479   , time:0.04586506ms
    out_f16f16_th: 141.50000000   , time:0.04933500ms
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
                         S=4096, K=2048
       out_f32f32: -1238.80456543 , time:0.16236329ms
     out_f32x4f32: -1238.80737305 , time:0.16246724ms
    out_f32f32_th: -1238.80859375 , time:0.16496468ms
--------------------------------------------------------------------------------
       out_f16f32: -1238.78466797 , time:0.11416745ms
     out_f16x2f32: -1239.28540039 , time:0.08488607ms
 out_f16x8packf32: -1238.85302734 , time:0.08867455ms
    out_f16f16_th: -1239.00000000 , time:0.09029007ms
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
                         S=4096, K=4096
       out_f32f32: 556.32690430   , time:0.31692672ms
     out_f32x4f32: 556.33087158   , time:0.31752276ms
    out_f32f32_th: 556.32879639   , time:0.32040811ms
--------------------------------------------------------------------------------
       out_f16f32: 554.45031738   , time:0.23417449ms
     out_f16x2f32: 553.61444092   , time:0.16469955ms
 out_f16x8packf32: 554.04040527   , time:0.16465998ms
    out_f16f16_th: 554.50000000   , time:0.17046404ms
--------------------------------------------------------------------------------
```
