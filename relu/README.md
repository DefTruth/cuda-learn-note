# Relu

## 0x00 说明

包含以下内容：

- [X] relu_f32_kernel
- [X] relu_f32x4_kernel(float4向量化版本)
- [X] relu_f16_kernel(fp16版本)
- [X] relu_f16x2_kernel(fp16向量化版本)
- [X] relu_f16x8_kernel(fp16向量化版本)
- [X] relu_f16x8_pack_kernel(fp16向量化，pack版本)
- [X] PyTorch bindings


## 测试

```bash
# 只测试Ada架构 不指定默认编译所有架构 耗时较长: Volta, Ampere, Ada, Hopper, ...
export TORCH_CUDA_ARCH_LIST=Ada 
python3 relu.py
```

输出:

```bash
-------------------------------------------------------------------------------------
                                        S=1024, K=1024
           out_f32: ['0.79806972  ', '1.46505046  '], time:0.02456141ms
         out_f32x4: ['0.79806972  ', '1.46505046  '], time:0.02465320ms
        out_f32_th: ['0.79806972  ', '1.46505046  '], time:0.02885103ms
-------------------------------------------------------------------------------------
           out_f16: ['0.79785156  ', '1.46484375  '], time:0.01526570ms
         out_f16x2: ['0.79785156  ', '1.46484375  '], time:0.01806116ms
         out_f16x8: ['0.79785156  ', '1.46484375  '], time:0.01348972ms
     out_f16x8pack: ['0.79785156  ', '1.46484375  '], time:0.00977635ms
        out_f16_th: ['0.79785156  ', '1.46484375  '], time:0.01408625ms
-------------------------------------------------------------------------------------
-------------------------------------------------------------------------------------
                                        S=1024, K=2048
           out_f32: ['1.20563018  ', '0.0         '], time:0.04486585ms
         out_f32x4: ['1.20563018  ', '0.0         '], time:0.04494834ms
        out_f32_th: ['1.20563018  ', '0.0         '], time:0.04886651ms
-------------------------------------------------------------------------------------
           out_f16: ['1.20605469  ', '0.0         '], time:0.02514172ms
         out_f16x2: ['1.20605469  ', '0.0         '], time:0.02471304ms
         out_f16x8: ['1.20605469  ', '0.0         '], time:0.02681494ms
     out_f16x8pack: ['1.20605469  ', '0.0         '], time:0.02463698ms
        out_f16_th: ['1.20605469  ', '0.0         '], time:0.02582216ms
-------------------------------------------------------------------------------------
-------------------------------------------------------------------------------------
                                        S=1024, K=4096
           out_f32: ['0.0         ', '0.90982169  '], time:0.08604836ms
         out_f32x4: ['0.0         ', '0.90982169  '], time:0.08591890ms
        out_f32_th: ['0.0         ', '0.90982169  '], time:0.08621097ms
-------------------------------------------------------------------------------------
           out_f16: ['0.0         ', '0.90966797  '], time:0.04756117ms
         out_f16x2: ['0.0         ', '0.90966797  '], time:0.04595661ms
         out_f16x8: ['0.0         ', '0.90966797  '], time:0.04451156ms
     out_f16x8pack: ['0.0         ', '0.90966797  '], time:0.04431796ms
        out_f16_th: ['0.0         ', '0.90966797  '], time:0.04506612ms
-------------------------------------------------------------------------------------
-------------------------------------------------------------------------------------
                                        S=2048, K=1024
           out_f32: ['0.0         ', '0.0         '], time:0.04598093ms
         out_f32x4: ['0.0         ', '0.0         '], time:0.04443717ms
        out_f32_th: ['0.0         ', '0.0         '], time:0.04801869ms
-------------------------------------------------------------------------------------
           out_f16: ['0.0         ', '0.0         '], time:0.03100157ms
         out_f16x2: ['0.0         ', '0.0         '], time:0.02555966ms
         out_f16x8: ['0.0         ', '0.0         '], time:0.04193330ms
     out_f16x8pack: ['0.0         ', '0.0         '], time:0.04258919ms
        out_f16_th: ['0.0         ', '0.0         '], time:0.02470374ms
-------------------------------------------------------------------------------------
-------------------------------------------------------------------------------------
                                        S=2048, K=2048
           out_f32: ['0.0         ', '0.94578385  '], time:0.08523440ms
         out_f32x4: ['0.0         ', '0.94578385  '], time:0.08621931ms
        out_f32_th: ['0.0         ', '0.94578385  '], time:0.08544874ms
-------------------------------------------------------------------------------------
           out_f16: ['0.0         ', '0.94580078  '], time:0.04602194ms
         out_f16x2: ['0.0         ', '0.94580078  '], time:0.04515576ms
         out_f16x8: ['0.0         ', '0.94580078  '], time:0.05522895ms
     out_f16x8pack: ['0.0         ', '0.94580078  '], time:0.04486275ms
        out_f16_th: ['0.0         ', '0.94580078  '], time:0.04666305ms
-------------------------------------------------------------------------------------
-------------------------------------------------------------------------------------
                                        S=2048, K=4096
           out_f32: ['0.0         ', '0.0         '], time:0.16896391ms
         out_f32x4: ['0.0         ', '0.0         '], time:0.16793561ms
        out_f32_th: ['0.0         ', '0.0         '], time:0.16879678ms
-------------------------------------------------------------------------------------
           out_f16: ['0.0         ', '0.0         '], time:0.08883739ms
         out_f16x2: ['0.0         ', '0.0         '], time:0.08635879ms
         out_f16x8: ['0.0         ', '0.0         '], time:0.08580709ms
     out_f16x8pack: ['0.0         ', '0.0         '], time:0.08512211ms
        out_f16_th: ['0.0         ', '0.0         '], time:0.08630967ms
-------------------------------------------------------------------------------------
-------------------------------------------------------------------------------------
                                        S=4096, K=1024
           out_f32: ['0.0         ', '0.0         '], time:0.08645654ms
         out_f32x4: ['0.0         ', '0.0         '], time:0.08497119ms
        out_f32_th: ['0.0         ', '0.0         '], time:0.08511257ms
-------------------------------------------------------------------------------------
           out_f16: ['0.0         ', '0.0         '], time:0.05840707ms
         out_f16x2: ['0.0         ', '0.0         '], time:0.04465365ms
         out_f16x8: ['0.0         ', '0.0         '], time:0.04450321ms
     out_f16x8pack: ['0.0         ', '0.0         '], time:0.04422402ms
        out_f16_th: ['0.0         ', '0.0         '], time:0.04708695ms
-------------------------------------------------------------------------------------
-------------------------------------------------------------------------------------
                                        S=4096, K=2048
           out_f32: ['0.0         ', '0.0         '], time:0.16815281ms
         out_f32x4: ['0.0         ', '0.0         '], time:0.17172694ms
        out_f32_th: ['0.0         ', '0.0         '], time:0.16958523ms
-------------------------------------------------------------------------------------
           out_f16: ['0.0         ', '0.0         '], time:0.08855033ms
         out_f16x2: ['0.0         ', '0.0         '], time:0.08629274ms
         out_f16x8: ['0.0         ', '0.0         '], time:0.08558035ms
     out_f16x8pack: ['0.0         ', '0.0         '], time:0.08516455ms
        out_f16_th: ['0.0         ', '0.0         '], time:0.08686042ms
-------------------------------------------------------------------------------------
-------------------------------------------------------------------------------------
                                        S=4096, K=4096
           out_f32: ['0.0         ', '0.0         '], time:0.33079863ms
         out_f32x4: ['0.0         ', '0.0         '], time:0.33377934ms
        out_f32_th: ['0.0         ', '0.0         '], time:0.33318114ms
-------------------------------------------------------------------------------------
           out_f16: ['0.0         ', '0.0         '], time:0.17186594ms
         out_f16x2: ['0.0         ', '0.0         '], time:0.17597079ms
         out_f16x8: ['0.0         ', '0.0         '], time:0.17410827ms
     out_f16x8pack: ['0.0         ', '0.0         '], time:0.16749001ms
        out_f16_th: ['0.0         ', '0.0         '], time:0.17059708ms
-------------------------------------------------------------------------------------
(py10) ➜  relu git:(opt-bench) ✗ python3 relu.py
-------------------------------------------------------------------------------------
                                        S=1024, K=1024
           out_f32: ['0.0         ', '0.0         '], time:0.02474284ms
         out_f32x4: ['0.0         ', '0.0         '], time:0.02794623ms
        out_f32_th: ['0.0         ', '0.0         '], time:0.02870893ms
-------------------------------------------------------------------------------------
           out_f16: ['0.0         ', '0.0         '], time:0.03280139ms
         out_f16x2: ['0.0         ', '0.0         '], time:0.01844454ms
         out_f16x8: ['0.0         ', '0.0         '], time:0.01130843ms
     out_f16x8pack: ['0.0         ', '0.0         '], time:0.03862119ms
        out_f16_th: ['0.0         ', '0.0         '], time:0.01374555ms
-------------------------------------------------------------------------------------
-------------------------------------------------------------------------------------
                                        S=1024, K=2048
           out_f32: ['0.0         ', '0.64133722  '], time:0.04452920ms
         out_f32x4: ['0.0         ', '0.64133722  '], time:0.04533052ms
        out_f32_th: ['0.0         ', '0.64133722  '], time:0.04694915ms
-------------------------------------------------------------------------------------
           out_f16: ['0.0         ', '0.64111328  '], time:0.02491307ms
         out_f16x2: ['0.0         ', '0.64111328  '], time:0.02553058ms
         out_f16x8: ['0.0         ', '0.64111328  '], time:0.02456164ms
     out_f16x8pack: ['0.0         ', '0.64111328  '], time:0.02439499ms
        out_f16_th: ['0.0         ', '0.64111328  '], time:0.02799058ms
-------------------------------------------------------------------------------------
-------------------------------------------------------------------------------------
                                        S=1024, K=4096
           out_f32: ['0.65429848  ', '2.75032473  '], time:0.08626246ms
         out_f32x4: ['0.65429848  ', '2.75032473  '], time:0.08715820ms
        out_f32_th: ['0.65429848  ', '2.75032473  '], time:0.08617997ms
-------------------------------------------------------------------------------------
           out_f16: ['0.65429688  ', '2.75        '], time:0.04689980ms
         out_f16x2: ['0.65429688  ', '2.75        '], time:0.04643893ms
         out_f16x8: ['0.65429688  ', '2.75        '], time:0.04470849ms
     out_f16x8pack: ['0.65429688  ', '2.75        '], time:0.04504633ms
        out_f16_th: ['0.65429688  ', '2.75        '], time:0.04588318ms
-------------------------------------------------------------------------------------
-------------------------------------------------------------------------------------
                                        S=2048, K=1024
           out_f32: ['0.0         ', '0.22344486  '], time:0.04485297ms
         out_f32x4: ['0.0         ', '0.22344486  '], time:0.04739833ms
        out_f32_th: ['0.0         ', '0.22344486  '], time:0.04488420ms
-------------------------------------------------------------------------------------
           out_f16: ['0.0         ', '0.22338867  '], time:0.03232741ms
         out_f16x2: ['0.0         ', '0.22338867  '], time:0.02448750ms
         out_f16x8: ['0.0         ', '0.22338867  '], time:0.02421331ms
     out_f16x8pack: ['0.0         ', '0.22338867  '], time:0.02462792ms
        out_f16_th: ['0.0         ', '0.22338867  '], time:0.02602458ms
-------------------------------------------------------------------------------------
-------------------------------------------------------------------------------------
                                        S=2048, K=2048
           out_f32: ['1.55512714  ', '0.0         '], time:0.08519292ms
         out_f32x4: ['1.55512714  ', '0.0         '], time:0.08652973ms
        out_f32_th: ['1.55512714  ', '0.0         '], time:0.08616257ms
-------------------------------------------------------------------------------------
           out_f16: ['1.5546875   ', '0.0         '], time:0.04674625ms
         out_f16x2: ['1.5546875   ', '0.0         '], time:0.04582286ms
         out_f16x8: ['1.5546875   ', '0.0         '], time:0.04621863ms
     out_f16x8pack: ['1.5546875   ', '0.0         '], time:0.04531288ms
        out_f16_th: ['1.5546875   ', '0.0         '], time:0.04569745ms
-------------------------------------------------------------------------------------
-------------------------------------------------------------------------------------
                                        S=2048, K=4096
           out_f32: ['0.0         ', '1.23181415  '], time:0.16837120ms
         out_f32x4: ['0.0         ', '1.23181415  '], time:0.16818452ms
        out_f32_th: ['0.0         ', '1.23181415  '], time:0.16882133ms
-------------------------------------------------------------------------------------
           out_f16: ['0.0         ', '1.23144531  '], time:0.08821988ms
         out_f16x2: ['0.0         ', '1.23144531  '], time:0.08769679ms
         out_f16x8: ['0.0         ', '1.23144531  '], time:0.08699489ms
     out_f16x8pack: ['0.0         ', '1.23144531  '], time:0.08604836ms
        out_f16_th: ['0.0         ', '1.23144531  '], time:0.08656883ms
-------------------------------------------------------------------------------------
-------------------------------------------------------------------------------------
                                        S=4096, K=1024
           out_f32: ['0.0         ', '0.0         '], time:0.08695388ms
         out_f32x4: ['0.0         ', '0.0         '], time:0.08566570ms
        out_f32_th: ['0.0         ', '0.0         '], time:0.08635354ms
-------------------------------------------------------------------------------------
           out_f16: ['0.0         ', '0.0         '], time:0.05836558ms
         out_f16x2: ['0.0         ', '0.0         '], time:0.04433990ms
         out_f16x8: ['0.0         ', '0.0         '], time:0.04537225ms
     out_f16x8pack: ['0.0         ', '0.0         '], time:0.04470086ms
        out_f16_th: ['0.0         ', '0.0         '], time:0.04651546ms
-------------------------------------------------------------------------------------
-------------------------------------------------------------------------------------
                                        S=4096, K=2048
           out_f32: ['0.0         ', '0.0         '], time:0.16860700ms
         out_f32x4: ['0.0         ', '0.0         '], time:0.16678166ms
        out_f32_th: ['0.0         ', '0.0         '], time:0.16704059ms
-------------------------------------------------------------------------------------
           out_f16: ['0.0         ', '0.0         '], time:0.08813882ms
         out_f16x2: ['0.0         ', '0.0         '], time:0.08665085ms
         out_f16x8: ['0.0         ', '0.0         '], time:0.08598089ms
     out_f16x8pack: ['0.0         ', '0.0         '], time:0.08585048ms
        out_f16_th: ['0.0         ', '0.0         '], time:0.08677530ms
-------------------------------------------------------------------------------------
-------------------------------------------------------------------------------------
                                        S=4096, K=4096
           out_f32: ['0.7885949   ', '0.70537478  '], time:0.32992506ms
         out_f32x4: ['0.7885949   ', '0.70537478  '], time:0.33172369ms
        out_f32_th: ['0.7885949   ', '0.70537478  '], time:0.33295250ms
-------------------------------------------------------------------------------------
           out_f16: ['0.78857422  ', '0.70556641  '], time:0.17281485ms
         out_f16x2: ['0.78857422  ', '0.70556641  '], time:0.16848612ms
         out_f16x8: ['0.78857422  ', '0.70556641  '], time:0.16776872ms
     out_f16x8pack: ['0.78857422  ', '0.70556641  '], time:0.16774631ms
        out_f16_th: ['0.78857422  ', '0.70556641  '], time:0.16836333ms
-------------------------------------------------------------------------------------
```
