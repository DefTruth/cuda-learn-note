# Mat Transpose

## 0x00 说明

包含以下内容：

- [X] mat_transpose_f32_col2row_kernel
- [X] mat_transpose_f32_row2col_kernel
- [X] mat_transpose_f32x4_col2row_kernel(float4向量化版本)
- [X] mat_transpose_f32x4_row2col_kernel(float4向量化版本) (施工中)
- [ ] mat_transpose_f32x4_shared_col2row_kernel(float4向量化版本，共享内存) (施工中)
- [ ] mat_transpose_f32x4_shared_row2col_kernel(float4向量化版本，共享内存) (施工中)
- [ ] mat_transpose_f32x4_shared_bcf_col2row_kernel(float4向量化版本，共享内存，去bank conflict) (施工中)
- [ ] mat_transpose_f32x4_shared_bcf_row2col_kernel(float4向量化版本，共享内存，去bank conflict) (施工中)
- [X] PyTorch bindings



## 测试

```bash
# 只测试Ada架构 不指定默认编译所有架构 耗时较长: Volta, Ampere, Ada, Hopper, ...
export TORCH_CUDA_ARCH_LIST=Ada 
python3 mat_transpose.py
```

输出:

```bash
--------------------------------------------------------------------------------------------------------------
                                                  S=1024, K=1024
                   out_out_original: [1.22929931, -1.64393926, 1.08275747], time:0.00008798ms
                    out_f32_col2row: [1.22929931, 1.08275747, -1.64393926], time:0.03607178ms
                    out_f32_row2col: [1.22929931, 1.08275747, -1.64393926], time:0.01946306ms
                  out_f32x4_col2row: [1.22929931, 1.08275747, -1.64393926], time:0.01183987ms
                  out_f32x4_row2col: [1.22929931, 1.08275747, -1.64393926], time:0.00672626ms
                         out_f32_th: [1.22929931, 1.08275747, -1.64393926], time:0.03116775ms
--------------------------------------------------------------------------------------------------------------
--------------------------------------------------------------------------------------------------------------
                                                  S=1024, K=2048
                   out_out_original: [-0.08074856, 1.33547139, 1.28616774], time:0.00007534ms
                    out_f32_col2row: [-0.08074856, 1.28616774, 1.33547139], time:0.06723928ms
                    out_f32_row2col: [-0.08074856, 1.28616774, 1.33547139], time:0.03532958ms
                  out_f32x4_col2row: [-0.08074856, 1.28616774, 1.33547139], time:0.01893830ms
                  out_f32x4_row2col: [-0.08074856, 1.28616774, 1.33547139], time:0.01029086ms
                         out_f32_th: [-0.08074856, 1.28616774, 1.33547139], time:0.05788016ms
--------------------------------------------------------------------------------------------------------------
--------------------------------------------------------------------------------------------------------------
                                                  S=1024, K=4096
                   out_out_original: [-0.4994663, -0.50957698, -1.47937012], time:0.00007081ms
                    out_f32_col2row: [-0.4994663, -1.47937012, -0.50957698], time:0.11681843ms
                    out_f32_row2col: [-0.4994663, -1.47937012, -0.50957698], time:0.06690025ms
                  out_f32x4_col2row: [-0.4994663, -1.47937012, -0.50957698], time:0.03611827ms
                  out_f32x4_row2col: [-0.4994663, -1.47937012, -0.50957698], time:0.01809812ms
                         out_f32_th: [-0.4994663, -1.47937012, -0.50957698], time:0.10804296ms
--------------------------------------------------------------------------------------------------------------
--------------------------------------------------------------------------------------------------------------
                                                  S=2048, K=1024
                   out_out_original: [-0.3306568, 0.32352087, 0.24355641], time:0.00007296ms
                    out_f32_col2row: [-0.3306568, 0.24355641, 0.32352087], time:0.06246710ms
                    out_f32_row2col: [-0.3306568, 0.24355641, 0.32352087], time:0.03536057ms
                  out_f32x4_col2row: [-0.3306568, 0.24355641, 0.32352087], time:0.01883507ms
                  out_f32x4_row2col: [-0.3306568, 0.24355641, 0.32352087], time:0.01088333ms
                         out_f32_th: [-0.3306568, 0.24355641, 0.32352087], time:0.05709243ms
--------------------------------------------------------------------------------------------------------------
--------------------------------------------------------------------------------------------------------------
                                                  S=2048, K=2048
                   out_out_original: [1.10170686, -0.42346659, 0.70699865], time:0.00007129ms
                    out_f32_col2row: [1.10170686, 0.70699865, -0.42346659], time:0.11742353ms
                    out_f32_row2col: [1.10170686, 0.70699865, -0.42346659], time:0.06970596ms
                  out_f32x4_col2row: [1.10170686, 0.70699865, -0.42346659], time:0.03559661ms
                  out_f32x4_row2col: [1.10170686, 0.70699865, -0.42346659], time:0.01884222ms
                         out_f32_th: [1.10170686, 0.70699865, -0.42346659], time:0.10911560ms
--------------------------------------------------------------------------------------------------------------
--------------------------------------------------------------------------------------------------------------
                                                  S=2048, K=4096
                   out_out_original: [-0.52030063, 0.93595636, -2.62795138], time:0.00007200ms
                    out_f32_col2row: [-0.52030063, -2.62795138, 0.93595636], time:0.23295379ms
                    out_f32_row2col: [-0.52030063, -2.62795138, 0.93595636], time:0.14120889ms
                  out_f32x4_col2row: [-0.52030063, -2.62795138, 0.93595636], time:0.06648493ms
                  out_f32x4_row2col: [-0.52030063, -2.62795138, 0.93595636], time:0.03651857ms
                         out_f32_th: [-0.52030063, -2.62795138, 0.93595636], time:0.21480560ms
--------------------------------------------------------------------------------------------------------------
--------------------------------------------------------------------------------------------------------------
                                                  S=4096, K=1024
                   out_out_original: [-0.52635556, -0.46948266, 1.08574343], time:0.00007176ms
                    out_f32_col2row: [-0.52635556, 1.08574343, -0.46948266], time:0.11939001ms
                    out_f32_row2col: [-0.52635556, 1.08574343, -0.46948266], time:0.07638288ms
                  out_f32x4_col2row: [-0.52635556, 1.08574343, -0.46948266], time:0.03653049ms
                  out_f32x4_row2col: [-0.52635556, 1.08574343, -0.46948266], time:0.01893497ms
                         out_f32_th: [-0.52635556, 1.08574343, -0.46948266], time:0.11552286ms
--------------------------------------------------------------------------------------------------------------
--------------------------------------------------------------------------------------------------------------
                                                  S=4096, K=2048
                   out_out_original: [0.32466942, 0.60769016, 1.40713489], time:0.00007296ms
                    out_f32_col2row: [0.32466942, 1.40713489, 0.60769016], time:0.23403168ms
                    out_f32_row2col: [0.32466942, 1.40713489, 0.60769016], time:0.15938258ms
                  out_f32x4_col2row: [0.32466942, 1.40713489, 0.60769016], time:0.06535363ms
                  out_f32x4_row2col: [0.32466942, 1.40713489, 0.60769016], time:0.03715563ms
                         out_f32_th: [0.32466942, 1.40713489, 0.60769016], time:0.23206973ms
--------------------------------------------------------------------------------------------------------------
--------------------------------------------------------------------------------------------------------------
                                                  S=4096, K=4096
                   out_out_original: [0.33134502, 0.95345509, 0.61300254], time:0.00007296ms
                    out_f32_col2row: [0.33134502, 0.61300254, 0.95345509], time:0.46065736ms
                    out_f32_row2col: [0.33134502, 0.61300254, 0.95345509], time:0.34583426ms
                  out_f32x4_col2row: [0.33134502, 0.61300254, 0.95345509], time:0.12868142ms
                  out_f32x4_row2col: [0.33134502, 0.61300254, 0.95345509], time:0.07924414ms
                         out_f32_th: [0.33134502, 0.61300254, 0.95345509], time:0.48074031ms
--------------------------------------------------------------------------------------------------------------
```
