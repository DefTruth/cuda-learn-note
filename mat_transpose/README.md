# Mat Transpose

## 0x00 说明

包含以下内容：

- [X] mat_transpose_f32_col2row_kernel
- [X] mat_transpose_f32_row2col_kernel
- [X] mat_transpose_f32x4_col2row_kernel(float4向量化版本)
- [X] mat_transpose_f32x4_row2col_kernel(float4向量化版本)
- [X] mat_transpose_f32_diagnonal(对角轴应用于S=K)
- [ ] mat_transpose_f32x4_shared_col2row_kernel(float4向量化版本，共享内存) (施工中)
- [ ] mat_transpose_f32x4_shared_row2col_kernel(float4向量化版本，共享内存) (施工中)
- [ ] mat_transpose_f32x4_shared_bcf_col2row_kernel(float4向量化版本，共享内存，去bank conflict) (施工中)
- [ ] mat_transpose_f32x4_shared_bcf_row2col_kernel(float4向量化版本，共享内存，去bank conflict) (施工中)
- [X] PyTorch bindings



## 测试

```bash
# 只测试Ada架构 不指定默认编译所有架构 耗时较长: Volta, Ampere, Ada, Hopper, ...
export TORCH_CUDA_ARCH_LIST=Ada 
python3 mat_transpose.py
```

输出:

```bash
--------------------------------------------------------------------------------------------------------------
                                                  S=1024, K=1024
                   out_out_original: [0.23565565, -0.63057262, 0.22917864], validate False, time:0.00007772ms
                    out_f32_col2row: [0.23565565, 0.22917864, -0.63057262], validate True, time:0.03598547ms
                    out_f32_row2col: [0.23565565, 0.22917864, -0.63057262], validate True, time:0.01939583ms
                out_f32_col2row(2d): [0.23565565, 0.22917864, -0.63057262], validate True, time:0.01675582ms
                out_f32_row2col(2d): [0.23565565, 0.22917864, -0.63057262], validate True, time:0.01678133ms
                  out_f32_diagnonal: [0.23565565, 0.22917864, -0.63057262], validate True, time:0.01320767ms
                  out_f32x4_col2row: [0.23565565, 0.22917864, -0.63057262], validate True, time:0.03616643ms
                  out_f32x4_row2col: [0.23565565, 0.22917864, -0.63057262], validate True, time:0.01914406ms
              out_f32x4_col2row(2d): [0.23565565, 0.22917864, -0.63057262], validate True, time:0.01892567ms
              out_f32x4_row2col(2d): [0.23565565, 0.22917864, -0.63057262], validate True, time:0.01789284ms
                         out_f32_th: [0.23565565, 0.22917864, -0.63057262], validate True, time:0.03002048ms
--------------------------------------------------------------------------------------------------------------
--------------------------------------------------------------------------------------------------------------
                                                  S=1024, K=2048
                   out_out_original: [-0.2630572, 0.91784197, 0.91583782], validate False, time:0.00007439ms
                    out_f32_col2row: [-0.2630572, 0.91583782, 0.91784197], validate True, time:0.06105471ms
                    out_f32_row2col: [-0.2630572, 0.91583782, 0.91784197], validate True, time:0.03337407ms
                out_f32_col2row(2d): [-0.2630572, 0.91583782, 0.91784197], validate True, time:0.02972364ms
                out_f32_row2col(2d): [-0.2630572, 0.91583782, 0.91784197], validate True, time:0.03035617ms
                  out_f32x4_col2row: [-0.2630572, 0.91583782, 0.91784197], validate True, time:0.06288624ms
                  out_f32x4_row2col: [-0.2630572, 0.91583782, 0.91784197], validate True, time:0.03324151ms
              out_f32x4_col2row(2d): [-0.2630572, 0.91583782, 0.91784197], validate True, time:0.03345037ms
              out_f32x4_row2col(2d): [-0.2630572, 0.91583782, 0.91784197], validate True, time:0.03921914ms
                         out_f32_th: [-0.2630572, 0.91583782, 0.91784197], validate True, time:0.05569530ms
--------------------------------------------------------------------------------------------------------------
--------------------------------------------------------------------------------------------------------------
                                                  S=1024, K=4096
                   out_out_original: [0.33094394, -1.07262981, -0.15070236], validate False, time:0.00007248ms
                    out_f32_col2row: [0.33094394, -0.15070236, -1.07262981], validate True, time:0.11716986ms
                    out_f32_row2col: [0.33094394, -0.15070236, -1.07262981], validate True, time:0.06721044ms
                out_f32_col2row(2d): [0.33094394, -0.15070236, -1.07262981], validate True, time:0.06273556ms
                out_f32_row2col(2d): [0.33094394, -0.15070236, -1.07262981], validate True, time:0.06113744ms
                  out_f32x4_col2row: [0.33094394, -0.15070236, -1.07262981], validate True, time:0.12009883ms
                  out_f32x4_row2col: [0.33094394, -0.15070236, -1.07262981], validate True, time:0.06633902ms
              out_f32x4_col2row(2d): [0.33094394, -0.15070236, -1.07262981], validate True, time:0.06348419ms
              out_f32x4_row2col(2d): [0.33094394, -0.15070236, -1.07262981], validate True, time:0.07859993ms
                         out_f32_th: [0.33094394, -0.15070236, -1.07262981], validate True, time:0.10680223ms
--------------------------------------------------------------------------------------------------------------
--------------------------------------------------------------------------------------------------------------
                                                  S=2048, K=1024
                   out_out_original: [1.67399216, -0.83752918, 1.44579601], validate False, time:0.00007010ms
                    out_f32_col2row: [1.67399216, 1.44579601, -0.83752918], validate True, time:0.06260681ms
                    out_f32_row2col: [1.67399216, 1.44579601, -0.83752918], validate True, time:0.03536320ms
                out_f32_col2row(2d): [1.67399216, 1.44579601, -0.83752918], validate True, time:0.03032112ms
                out_f32_row2col(2d): [1.67399216, 1.44579601, -0.83752918], validate True, time:0.02983451ms
                  out_f32x4_col2row: [1.67399216, 1.44579601, -0.83752918], validate True, time:0.06340647ms
                  out_f32x4_row2col: [1.67399216, 1.44579601, -0.83752918], validate True, time:0.03410363ms
              out_f32x4_col2row(2d): [1.67399216, 1.44579601, -0.83752918], validate True, time:0.03306317ms
              out_f32x4_row2col(2d): [1.67399216, 1.44579601, -0.83752918], validate True, time:0.03893566ms
                         out_f32_th: [1.67399216, 1.44579601, -0.83752918], validate True, time:0.05660605ms
--------------------------------------------------------------------------------------------------------------
--------------------------------------------------------------------------------------------------------------
                                                  S=2048, K=2048
                   out_out_original: [0.48145181, 0.36005804, -1.79453504], validate False, time:0.00007463ms
                    out_f32_col2row: [0.48145181, -1.79453504, 0.36005804], validate True, time:0.11716342ms
                    out_f32_row2col: [0.48145181, -1.79453504, 0.36005804], validate True, time:0.06980252ms
                out_f32_col2row(2d): [0.48145181, -1.79453504, 0.36005804], validate True, time:0.06021380ms
                out_f32_row2col(2d): [0.48145181, -1.79453504, 0.36005804], validate True, time:0.05885720ms
                  out_f32_diagnonal: [0.48145181, -1.79453504, 0.36005804], validate True, time:0.04902005ms
                  out_f32x4_col2row: [0.48145181, -1.79453504, 0.36005804], validate True, time:0.11964273ms
                  out_f32x4_row2col: [0.48145181, -1.79453504, 0.36005804], validate True, time:0.06714773ms
              out_f32x4_col2row(2d): [0.48145181, -1.79453504, 0.36005804], validate True, time:0.06364107ms
              out_f32x4_row2col(2d): [0.48145181, -1.79453504, 0.36005804], validate True, time:0.07860851ms
                         out_f32_th: [0.48145181, -1.79453504, 0.36005804], validate True, time:0.10834575ms
--------------------------------------------------------------------------------------------------------------
--------------------------------------------------------------------------------------------------------------
                                                  S=2048, K=4096
                   out_out_original: [0.55808294, 0.02721433, -1.62672687], validate False, time:0.00007606ms
                    out_f32_col2row: [0.55808294, -1.62672687, 0.02721433], validate True, time:0.23105979ms
                    out_f32_row2col: [0.55808294, -1.62672687, 0.02721433], validate True, time:0.14104533ms
                out_f32_col2row(2d): [0.55808294, -1.62672687, 0.02721433], validate True, time:0.12204003ms
                out_f32_row2col(2d): [0.55808294, -1.62672687, 0.02721433], validate True, time:0.11985540ms
                  out_f32x4_col2row: [0.55808294, -1.62672687, 0.02721433], validate True, time:0.23508883ms
                  out_f32x4_row2col: [0.55808294, -1.62672687, 0.02721433], validate True, time:0.13981438ms
              out_f32x4_col2row(2d): [0.55808294, -1.62672687, 0.02721433], validate True, time:0.12763381ms
              out_f32x4_row2col(2d): [0.55808294, -1.62672687, 0.02721433], validate True, time:0.15610981ms
                         out_f32_th: [0.55808294, -1.62672687, 0.02721433], validate True, time:0.21387768ms
--------------------------------------------------------------------------------------------------------------
--------------------------------------------------------------------------------------------------------------
                                                  S=4096, K=1024
                   out_out_original: [-1.69611466, -0.86834592, -1.54428291], validate False, time:0.00007105ms
                    out_f32_col2row: [-1.69611466, -1.54428291, -0.86834592], validate True, time:0.11884260ms
                    out_f32_row2col: [-1.69611466, -1.54428291, -0.86834592], validate True, time:0.07625079ms
                out_f32_col2row(2d): [-1.69611466, -1.54428291, -0.86834592], validate True, time:0.05878186ms
                out_f32_row2col(2d): [-1.69611466, -1.54428291, -0.86834592], validate True, time:0.05781937ms
                  out_f32x4_col2row: [-1.69611466, -1.54428291, -0.86834592], validate True, time:0.12253737ms
                  out_f32x4_row2col: [-1.69611466, -1.54428291, -0.86834592], validate True, time:0.06873012ms
              out_f32x4_col2row(2d): [-1.69611466, -1.54428291, -0.86834592], validate True, time:0.06428480ms
              out_f32x4_row2col(2d): [-1.69611466, -1.54428291, -0.86834592], validate True, time:0.07869267ms
                         out_f32_th: [-1.69611466, -1.54428291, -0.86834592], validate True, time:0.11523008ms
--------------------------------------------------------------------------------------------------------------
--------------------------------------------------------------------------------------------------------------
                                                  S=4096, K=2048
                   out_out_original: [0.22900137, 1.22266233, 0.81847143], validate False, time:0.00007558ms
                    out_f32_col2row: [0.22900137, 0.81847143, 1.22266233], validate True, time:0.23369718ms
                    out_f32_row2col: [0.22900137, 0.81847143, 1.22266233], validate True, time:0.15931106ms
                out_f32_col2row(2d): [0.22900137, 0.81847143, 1.22266233], validate True, time:0.11654139ms
                out_f32_row2col(2d): [0.22900137, 0.81847143, 1.22266233], validate True, time:0.11590433ms
                  out_f32x4_col2row: [0.22900137, 0.81847143, 1.22266233], validate True, time:0.23656678ms
                  out_f32x4_row2col: [0.22900137, 0.81847143, 1.22266233], validate True, time:0.14308000ms
              out_f32x4_col2row(2d): [0.22900137, 0.81847143, 1.22266233], validate True, time:0.12799144ms
              out_f32x4_row2col(2d): [0.22900137, 0.81847143, 1.22266233], validate True, time:0.15711164ms
                         out_f32_th: [0.22900137, 0.81847143, 1.22266233], validate True, time:0.23170900ms
--------------------------------------------------------------------------------------------------------------
--------------------------------------------------------------------------------------------------------------
                                                  S=4096, K=4096
                   out_out_original: [-0.55172211, 1.56761289, -0.553837], validate False, time:0.00007272ms
                    out_f32_col2row: [-0.55172211, -0.553837, 1.56761289], validate True, time:0.46105742ms
                    out_f32_row2col: [-0.55172211, -0.553837, 1.56761289], validate True, time:0.34592748ms
                out_f32_col2row(2d): [-0.55172211, -0.553837, 1.56761289], validate True, time:0.24684739ms
                out_f32_row2col(2d): [-0.55172211, -0.553837, 1.56761289], validate True, time:0.24025440ms
                  out_f32_diagnonal: [-0.55172211, -0.553837, 1.56761289], validate True, time:0.24954057ms
                  out_f32x4_col2row: [-0.55172211, -0.553837, 1.56761289], validate True, time:0.46223664ms
                  out_f32x4_row2col: [-0.55172211, -0.553837, 1.56761289], validate True, time:0.29578376ms
              out_f32x4_col2row(2d): [-0.55172211, -0.553837, 1.56761289], validate True, time:0.24502969ms
              out_f32x4_row2col(2d): [-0.55172211, -0.553837, 1.56761289], validate True, time:0.31572056ms
                         out_f32_th: [-0.55172211, -0.553837, 1.56761289], validate True, time:0.48020482ms
--------------------------------------------------------------------------------------------------------------
```
